import{c as f,s as h,r as l,j as e,L as $}from"./index-HXAgaps0.js";import{L as E}from"./link-2-CQMEUxfK.js";import{C as A}from"./clock-BStrjUFX.js";import{C as L}from"./calendar-D4cENPbn.js";import{M as P}from"./map-pin-C5WG6sb3.js";import{U as T}from"./users-PrMozuYx.js";import{C as R}from"./chevron-right-DV8Uxe7K.js";const z=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],D=f("chevron-left",z);const I=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],O=f("pause",I);const H=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],U=f("play",H);const B=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],N=f("shield-alert",B);const F=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],k=f("shield-check",F);const G=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],V=f("skip-back",G);const J=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],K=f("skip-forward",J);async function ae(){const{data:t}=await h.rpc("get_tag_signal_density");return t||[]}function ne(t,s){const n=h.channel("signal-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"coordination_interests"},t);return s&&n.on("postgres_changes",{event:"DELETE",schema:"public",table:"coordination_interests"},s),n.subscribe(),()=>{h.removeChannel(n)}}async function re(t=5){const{data:s}=await h.from("coordination_signal_summary").select("artifact_id, signal_count, unique_participants").order("signal_count",{ascending:!1}).limit(t);if(!s||s.length===0)return[];const n=s.map(o=>o.artifact_id),{data:i}=await h.from("artifacts").select("id, title, type").in("id",n);return s.map(o=>{const x=(i||[]).find(p=>p.id===o.artifact_id);return{...o,title:x?.title||"Unknown",type:x?.type||"idea"}})}function ie({compact:t=!1}){const[s,n]=l.useState(null);return l.useEffect(()=>{h.rpc("chain_head").then(({data:i})=>{i&&i.length>0&&n(i[0])})},[]),s?t?e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[s.chain_intact?e.jsx(k,{className:"w-3.5 h-3.5 text-emerald-400"}):e.jsx(N,{className:"w-3.5 h-3.5 text-red-400"}),e.jsxs("span",{className:"text-gray-400",children:["Chain #",s.head_seq]}),e.jsxs("span",{className:"font-mono text-gray-600",title:s.head_hash,children:[s.head_hash?.slice(0,8),"…"]})]}):e.jsxs("div",{className:"rounded-lg border border-[#1d2839] bg-[#0a101d] p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(E,{className:"w-4 h-4 text-[#a6ed2a]"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Convergence Chain"}),s.chain_intact?e.jsxs("span",{className:"ml-auto flex items-center gap-1 text-xs text-emerald-400",children:[e.jsx(k,{className:"w-3.5 h-3.5"})," Intact"]}):e.jsxs("span",{className:"ml-auto flex items-center gap-1 text-xs text-red-400",children:[e.jsx(N,{className:"w-3.5 h-3.5"})," Broken"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"HEAD"}),e.jsxs("div",{className:"font-mono text-white",children:["#",s.head_seq]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Hash"}),e.jsxs("div",{className:"font-mono text-gray-300 text-xs truncate",title:s.head_hash,children:[s.head_hash?.slice(0,16),"…"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Contributions"}),e.jsx("div",{className:"text-white",children:s.total_contributions})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 text-xs",children:"Artifacts"}),e.jsx("div",{className:"text-white",children:s.total_artifacts})]})]})]}):null}function Z(t){const s=Math.floor((Date.now()-new Date(t).getTime())/1e3);return s<60?`${s}s ago`:s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:`${Math.floor(s/86400)}d ago`}function le({maxSeq:t,onSeqChange:s}){const[n,i]=l.useState(t),[o,x]=l.useState(!1),[p,m]=l.useState([]),[d,u]=l.useState(null),b=l.useCallback(async r=>{const{data:c}=await h.rpc("replay_chain",{p_from_seq:1,p_to_seq:r});c&&(m(c),u(c[c.length-1]||null),s(r,c))},[s]);return l.useEffect(()=>{b(n)},[n]),l.useEffect(()=>{if(!o)return;if(n>=t){x(!1);return}const r=setTimeout(()=>{i(c=>Math.min(c+1,t))},1500);return()=>clearTimeout(r)},[o,n,t]),e.jsxs("div",{className:"rounded-lg border border-[#1d2839] bg-[#0a101d] p-4 pb-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(A,{className:"w-4 h-4 text-[#a6ed2a]"}),e.jsx("h3",{className:"text-sm font-semibold text-white",children:"Graph Replay"}),e.jsxs("span",{className:"ml-auto text-xs text-gray-500",children:["State #",n," of ",t]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"range",min:1,max:t,value:n,onChange:r=>{x(!1),i(Number(r.target.value))},className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{background:"#1d2839"}})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>{x(!1),i(Math.max(1,n-1))},className:"p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-[#1d2839] transition-colors disabled:opacity-30",disabled:n<=1,"aria-label":"Previous step",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x(!o),className:"p-2 rounded-lg bg-[#a6ed2a] text-[#080c16] hover:bg-[#b8f247] transition-colors","aria-label":o?"Pause":"Play",children:o?e.jsx(O,{className:"w-4 h-4"}):e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{x(!1),i(Math.min(t,n+1))},className:"p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-[#1d2839] transition-colors disabled:opacity-30",disabled:n>=t,"aria-label":"Next step",children:e.jsx(K,{className:"w-4 h-4"})})]}),d&&e.jsxs("div",{className:"border-t border-[#1d2839] pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-xs font-mono text-gray-500",children:["#",d.seq," · ",d.chain_hash?.slice(0,12),"…"]}),e.jsx("span",{className:"text-xs text-gray-600",children:Z(d.created_at)})]}),e.jsx("p",{className:"text-sm text-gray-300 line-clamp-2 mb-2",children:d.content?.slice(0,200)}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:[d.artifact_count," artifact",d.artifact_count!==1?"s":""," extracted"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[p.reduce((r,c)=>r+c.artifact_count,0)," total in graph"]})]})]}),e.jsx("div",{className:"flex gap-1 mt-3",children:Array.from({length:t},(r,c)=>c+1).map(r=>e.jsx("button",{onClick:()=>{x(!1),i(r)},className:`flex-1 h-1.5 rounded-full transition-colors ${r<=n?"bg-[#a6ed2a]":"bg-[#1d2839]"} ${r===n?"ring-1 ring-[#a6ed2a] ring-offset-1 ring-offset-[#0a101d]":""}`,"aria-label":`Jump to state ${r}`},r))})]})}const j={Privacy:"#6366f1",Creativity:"#ec4899","Public Goods Funding":"#22c55e","Ethereum Localism":"#f59e0b","d/acc":"#ef4444",DeSci:"#06b6d4","AI & Society":"#8b5cf6","Onchain Organizations":"#14b8a6","DAO Tooling":"#3b82f6",Hackathon:"#f97316"};function Q(t){return new Date(t).toLocaleString("en-US",{weekday:"short",hour:"numeric",minute:"2-digit"})}function ce({compact:t=!1,limit:s=20,trackFilter:n}){const[i,o]=l.useState([]),[x,p]=l.useState(!0),[m,d]=l.useState(0),[u,b]=l.useState(n||""),[r,c]=l.useState([]),g=t?6:s;l.useEffect(()=>{v()},[u]);async function v(){let a=h.from("sessions").select("*").order("time_start",{ascending:!0,nullsFirst:!1});u&&(a=a.eq("track",u));const{data:w}=await a;if(o(w||[]),r.length===0){const{data:C}=await h.from("sessions").select("track"),S=[...new Set((C||[]).map(M=>M.track).filter(Boolean))];c(S.sort())}p(!1)}if(x)return e.jsx("div",{className:"text-gray-500 text-xs py-4 text-center",children:"Loading sessions..."});if(i.length===0)return null;const _=i.slice(m*g,(m+1)*g),y=Math.ceil(i.length/g);return e.jsxs("div",{children:[!n&&r.length>0&&e.jsxs("div",{className:`flex items-center gap-1.5 mb-2 flex-wrap ${t?"":"mb-3"}`,children:[e.jsxs("button",{onClick:()=>{b(""),d(0)},className:`px-2 py-0.5 rounded text-xs transition-colors ${u?"bg-[#1d2839] text-gray-400 hover:text-white":"bg-[#a6ed2a] text-[#080c16]"}`,children:["All (",i.length,")"]}),r.map(a=>e.jsx("button",{onClick:()=>{b(a),d(0)},className:`px-2 py-0.5 rounded text-xs transition-colors ${u===a?"text-[#080c16] font-medium":"text-gray-400 hover:text-white"}`,style:u===a?{backgroundColor:j[a]||"#a6ed2a"}:{backgroundColor:"#1d2839"},children:a},a))]}),e.jsx("div",{className:t?"space-y-0.5":"space-y-1.5",children:_.map(a=>e.jsxs($,{to:`/session/${a.id}`,className:`block bg-[#0a101d] border border-[#1d2839] rounded hover:border-[#a6ed2a] transition-colors ${t?"px-2 py-1.5":"rounded-lg px-3 py-2.5"}`,children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[a.track&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full flex-shrink-0",style:{backgroundColor:j[a.track]||"#666"}}),e.jsx("h3",{className:`font-medium text-white truncate ${t?"text-[11px]":"text-sm"}`,children:a.title})]}),e.jsxs("div",{className:`flex items-center gap-2 flex-wrap ${t?"text-[9px]":"text-xs"} text-gray-500`,children:[a.time_start&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(L,{className:t?"w-2.5 h-2.5":"w-3 h-3"}),Q(a.time_start)]}),a.location&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(P,{className:t?"w-2.5 h-2.5":"w-3 h-3"}),a.location]}),a.speakers&&a.speakers.length>0&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(T,{className:t?"w-2.5 h-2.5":"w-3 h-3"}),a.speakers.join(", ")]})]})]}),a.track&&e.jsx("span",{className:`flex-shrink-0 px-1.5 py-0.5 rounded ${t?"text-[8px]":"text-[10px]"}`,style:{backgroundColor:(j[a.track]||"#666")+"20",color:j[a.track]||"#999"},children:a.track})]}),!t&&a.description&&e.jsx("p",{className:"text-xs text-gray-400 line-clamp-1 mt-1",children:a.description})]},a.id))}),y>1&&e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("button",{onClick:()=>d(a=>Math.max(0,a-1)),disabled:m===0,className:"p-1 text-xs rounded bg-[#0a101d] border border-[#1d2839] text-gray-300 hover:border-[#a6ed2a] transition-colors disabled:opacity-30",children:e.jsx(D,{className:"w-3 h-3"})}),e.jsxs("span",{className:`${t?"text-[9px]":"text-xs"} text-gray-500`,children:[m*g+1,"–",Math.min((m+1)*g,i.length)," of ",i.length," sessions"]}),e.jsx("button",{onClick:()=>d(a=>Math.min(y-1,a+1)),disabled:m>=y-1,className:"p-1 text-xs rounded bg-[#0a101d] border border-[#1d2839] text-gray-300 hover:border-[#a6ed2a] transition-colors disabled:opacity-30",children:e.jsx(R,{className:"w-3 h-3"})})]})]})}export{ie as C,le as R,ce as S,D as a,ae as b,re as f,ne as s};
