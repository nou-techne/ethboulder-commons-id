import{g as W,h as q,r as a,s as i,j as e,L as F}from"./index-C1rFkvFB.js";import{E as H}from"./ExtractionProgress-ZF2bDNsk.js";import{Z as M}from"./zap-B3y5n0TA.js";import{C as $}from"./check-C5qKksiE.js";const z={e:{label:"Ecology",desc:"Environmental context, place, watershed, seasonal patterns"},H:{label:"Human",desc:"People, capabilities, relationships, lived experience"},L:{label:"Language",desc:"Shared vocabulary, frameworks, definitions"},A:{label:"Artifacts",desc:"Tools, documents, code, physical objects, infrastructure"},M:{label:"Methodology",desc:"Processes, workflows, practices, coordination patterns"},T:{label:"Training",desc:"Learning, skill development, transformation, practice"}},k="00000000-0000-0000-0000-000000000100";function Z(){const _=W(),[g]=q(),[o,p]=a.useState(""),[c,n]=a.useState("idle"),[I,b]=a.useState(Date.now()),[f,h]=a.useState(""),[d,j]=a.useState(null),[y,w]=a.useState(0),[N,v]=a.useState([]),[S,L]=a.useState([]),[E,A]=a.useState("");a.useEffect(()=>{D();const t=g.get("session");t&&A(t)},[g]);async function D(){const{data:t}=await i.from("sessions").select("id, title, time_start").eq("convergence_id",k).order("time_start",{ascending:!0,nullsFirst:!1});t&&L(t)}a.useEffect(()=>{if(!d)return;const t=i.channel(`contribution-${d}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"contributions",filter:`id=eq.${d}`},async s=>{const r=s.new.status;if(r==="processing")b(Date.now()),n("extracting");else if(r==="complete"){const l=s.new.extraction;if(l?.artifacts){w(l.artifacts.length);const m=l.artifacts.map(u=>u.title),{data:x}=await i.from("artifacts").select("id, title, type").in("title",m).order("created_at",{ascending:!1}).limit(10);v(x||[])}n("done")}else r==="error"&&(h("Extraction failed. Please try again."),n("error"))}).subscribe();return()=>{i.removeChannel(t)}},[d]);async function P(t){if(t.preventDefault(),!!o.trim()){n("submitting"),h("");try{const{data:{user:s}}=await i.auth.getUser();let r=null;if(s){const{data:x,error:u}=await i.from("participants").select("id").eq("auth_user_id",s.id).maybeSingle();if(u)throw u;if(x)r=x.id;else{const{data:T,error:C}=await i.from("participants").insert({auth_user_id:s.id,name:s.email?.split("@")[0]||"Anonymous",email:s.email}).select("id").single();if(C)throw C;r=T.id}}const{data:l,error:m}=await i.from("contributions").insert({content:o,convergence_id:k,participant_id:r,session_id:E||null,status:"pending"}).select("id").single();if(m)throw m;j(l.id),b(Date.now()),n("extracting")}catch(s){h(s?.message||"Something went wrong. Please try again."),n("error")}}}return c==="extracting"?e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#1d2839] flex items-center justify-center mx-auto mb-6 animate-pulse",children:e.jsx(M,{className:"w-8 h-8 text-[#a6ed2a]"})}),e.jsx("h2",{className:"text-xl font-bold mb-3",children:"Extracting knowledge..."}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:"AI is analyzing your contribution, identifying artifacts, tagging by dimension, and linking to the knowledge graph."}),e.jsx("div",{className:"mt-6",children:e.jsx(H,{startedAt:I})})]})}):c==="done"?e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#a6ed2a] flex items-center justify-center mx-auto mb-6",children:e.jsx($,{className:"w-8 h-8 text-[#080c16]",strokeWidth:3})}),e.jsxs("h2",{className:"text-xl font-bold mb-3",children:["Done! ",y," ",y===1?"artifact":"artifacts"," created"]}),e.jsx("p",{className:"text-gray-400 mb-6 max-w-md mx-auto",children:"Your contribution has been processed and added to the knowledge graph."}),N.length>0&&e.jsxs("div",{className:"mb-8 max-w-md mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Extracted artifacts:"}),e.jsx("div",{className:"space-y-2",children:N.map(t=>e.jsx(F,{to:`/artifact/${t.id}`,className:"block bg-[#0a101d] border border-[#1d2839] rounded-lg p-3 hover:border-[#a6ed2a] transition-colors text-left",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-[#1d2839] text-gray-400",children:t.type}),e.jsx("span",{className:"text-sm text-gray-300",children:t.title})]})},t.id))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx("button",{onClick:()=>{n("idle"),p(""),j(null),v([]),w(0)},className:"px-6 py-2.5 bg-[#1d2839] text-white rounded-lg hover:bg-[#283347] transition-colors text-sm",children:"Contribute more"}),e.jsx("button",{onClick:()=>_("/"),className:"px-6 py-2.5 bg-[#a6ed2a] text-[#080c16] rounded-lg hover:bg-[#b8f247] transition-colors text-sm",children:"Explore"})]})]})}):e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Contribute"}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Share what you observed, learned, or committed to. Write naturally — AI extracts the structure."}),e.jsxs("p",{className:"text-gray-500 text-xs mb-4",children:["First time? ",e.jsx("a",{href:"/app/welcome",className:"text-[#a6ed2a] hover:underline",children:"See how it works"})]}),e.jsxs("details",{className:"mb-6 bg-[#0a101d] border border-[#1d2839] rounded-lg overflow-hidden",open:typeof window<"u"?localStorage.getItem("hlamt-open")!=="false":!0,onToggle:t=>localStorage.setItem("hlamt-open",String(t.target.open)),children:[e.jsxs("summary",{className:"px-4 py-3 text-base font-medium text-white cursor-pointer hover:bg-[#1d2839] transition-colors flex items-center justify-between",children:[e.jsx("span",{children:"What is e/H-LAM/T?"}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"AI classifies every contribution across these six dimensions"})]}),e.jsx("div",{className:"px-4 pb-4 pt-2 grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(z).map(([t,{label:s,desc:r}])=>e.jsxs("div",{className:"bg-[#080c16] border border-[#1d2839] rounded-lg p-3",children:[e.jsxs("div",{className:"text-sm font-mono text-[#a6ed2a] mb-1 font-bold",children:[t,"/"]}),e.jsx("div",{className:"text-sm font-medium text-white mb-1",children:s}),e.jsx("div",{className:"text-xs text-gray-400 leading-relaxed",children:r})]},t))})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[S.length>0&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"session-select",className:"block text-sm font-medium text-gray-300 mb-2",children:"Session (optional)"}),e.jsxs("select",{id:"session-select",value:E,onChange:t=>A(t.target.value),className:"w-full bg-[#0a101d] border border-[#1d2839] rounded-lg px-4 py-2 text-white focus:outline-none focus:border-[#a6ed2a]",children:[e.jsx("option",{value:"",children:"No session"}),S.map(t=>e.jsxs("option",{value:t.id,children:[t.title,t.time_start&&` — ${new Date(t.time_start).toLocaleDateString()}`]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contribution-text",className:"sr-only",children:"Your contribution"}),e.jsx("textarea",{id:"contribution-text",value:o,onChange:t=>p(t.target.value),placeholder:`What happened? What did you learn? What are you going to do about it?

Write about a session you just attended, an idea someone sparked, a commitment you're making, or a pattern you're noticing across conversations.

A paragraph or two is ideal. Name people and projects when you can — it helps build the graph.`,rows:12,required:!0,className:"w-full bg-[#0a101d] border border-[#1d2839] rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] resize-y leading-relaxed text-base"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"AI classifies contribution type, extracts artifacts, and records relationships automatically."}),e.jsxs("span",{className:"text-xs text-gray-500",children:[o.length," chars"]})]})]}),f&&e.jsx("div",{className:"p-3 bg-red-900/20 border border-red-800/30 rounded-lg text-sm text-red-300",children:f}),e.jsx("button",{type:"submit",disabled:c==="submitting"||!o.trim(),className:"w-full bg-[#a6ed2a] text-[#080c16] hover:bg-[#b8f247] py-3 rounded-lg transition-colors disabled:opacity-50",children:c==="submitting"?"Saving...":"Submit to the Commons"})]})]})}export{Z as Contribute};
