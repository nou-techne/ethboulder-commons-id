import{r as d,j as e,L as x,i as b,s as u}from"./index-sqjsVm1m.js";import{A as _}from"./arrow-left-BLgX9Izv.js";import{M as j}from"./message-square-CbqAayVR.js";function y(a){const s=Math.floor((Date.now()-new Date(a).getTime())/1e3);return s<60?`${s}s ago`:s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:`${Math.floor(s/86400)}d ago`}function N(a,s,l=150){const n=a.toLowerCase().indexOf(s.toLowerCase());if(n===-1)return a.slice(0,l)+(a.length>l?"...":"");const i=Math.max(0,n-40),c=Math.min(a.length,n+s.length+80);return(i>0?"...":"")+a.slice(i,c)+(c<a.length?"...":"")}function M(){const[a,s]=d.useState(""),[l,o]=d.useState([]),[n,i]=d.useState(!1),[c,g]=d.useState(!1);async function h(){const t=a.trim();if(!t)return;i(!0),g(!0);const{data:r,error:f}=await u.from("messages").select(`
        id, content, created_at, author_id, thread_id,
        threads!inner(id, title, channel_id, channels!inner(slug, name))
      `).textSearch("search_vector",t,{type:"websearch"}).order("created_at",{ascending:!1}).limit(30);if(f||!r||r.length===0){const{data:p}=await u.from("messages").select(`
          id, content, created_at, author_id, thread_id,
          threads!inner(id, title, channel_id, channels!inner(slug, name))
        `).ilike("content",`%${t}%`).order("created_at",{ascending:!1}).limit(30);o(m(p))}else o(m(r));i(!1)}function m(t){return t?t.map(r=>({id:r.id,content:r.content,created_at:r.created_at,author_id:r.author_id,thread_id:r.thread_id,thread_title:r.threads?.title||"Untitled",channel_slug:r.threads?.channels?.slug||"",channel_name:r.threads?.channels?.name||""})):[]}return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(x,{to:"/channels",className:"text-gray-400 hover:text-white",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Search Messages"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{value:a,onChange:t=>s(t.target.value),onKeyDown:t=>t.key==="Enter"&&h(),placeholder:"Search message content...",className:"w-full bg-[#0a101d] border border-[#1d2839] rounded-lg pl-10 pr-4 py-2.5 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm"})]}),e.jsx("button",{onClick:h,disabled:!a.trim()||n,className:"bg-[#a6ed2a] text-[#080c16] px-5 py-2.5 rounded-lg hover:bg-[#b8f247] transition-colors text-sm font-medium disabled:opacity-50",children:n?"Searching...":"Search"})]}),c&&l.length===0&&!n&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(j,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"No results found"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Try different keywords."})]}),l.length>0&&e.jsx("div",{className:"space-y-2",children:l.map(t=>e.jsxs(x,{to:`/channels/${t.channel_slug}/${t.thread_id}`,className:"block bg-[#0a101d] border border-[#1d2839] rounded-lg px-4 py-3 hover:border-[#a6ed2a] transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-xs text-gray-500",children:[e.jsxs("span",{className:"text-[#a6ed2a]",children:["#",t.channel_name]}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-gray-300 font-medium",children:t.thread_title}),e.jsx("span",{className:"ml-auto",children:y(t.created_at)})]}),e.jsx("p",{className:"text-sm text-gray-300",children:N(t.content,a)}),t.author_id&&e.jsx("span",{className:"text-xs text-gray-600 mt-1 block",children:t.author_id.slice(0,8)})]},t.id))})]})}export{M as MessageSearch};
