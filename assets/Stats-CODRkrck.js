import{u as S,r,s as t,j as e}from"./index-Bg-tw-Nl.js";import{F as T}from"./file-text-ewxIcM0C.js";import{G as L}from"./git-branch-CvTDqrif.js";import{U as k}from"./users-Dy_vPf0k.js";import{T as C}from"./trending-up-BDC6FsKg.js";import{Z as _}from"./zap-DFyAfyV2.js";const A={"hlamt:e":"e/ Environment","hlamt:H":"H/ Human","hlamt:L":"L/ Language","hlamt:A":"A/ Artifacts","hlamt:M":"M/ Methodology","hlamt:T":"T/ Training","hlamt:S":"S/ Sessions"};function B(){const{convergence:h}=S(),[c,u]=r.useState({contributions:0,artifacts:0,participants:0,relationships:0,sessions:0}),[d,g]=r.useState([]),[m,b]=r.useState([]),[f,j]=r.useState(!0);r.useEffect(()=>{l();const s=t.channel("stats-updates").on("postgres_changes",{event:"*",schema:"public",table:"contributions"},l).on("postgres_changes",{event:"*",schema:"public",table:"artifacts"},l).subscribe();return()=>{t.removeChannel(s)}},[]);async function l(){const[{count:s},{count:N},{count:v},{count:y},{count:w},{data:x},{data:p}]=await Promise.all([t.from("contributions").select("*",{count:"exact",head:!0}),t.from("artifacts").select("*",{count:"exact",head:!0}),t.from("public_participants").select("*",{count:"exact",head:!0}),t.from("artifact_relationships").select("*",{count:"exact",head:!0}),t.from("sessions").select("*",{count:"exact",head:!0}),t.from("tags").select("name, artifact_tags(count)").like("name","hlamt:%").order("name"),t.from("artifacts").select("type").not("type","is",null)]);if(u({contributions:s||0,artifacts:N||0,participants:v||0,relationships:y||0,sessions:w||0}),x){const i=x.map(a=>({key:a.name,count:a.artifact_tags?.[0]?.count||0,label:A[a.name]||a.name})).sort((a,n)=>n.count-a.count);g(i)}if(p){const i={};for(const n of p)i[n.type]=(i[n.type]||0)+1;const a=Object.entries(i).map(([n,o])=>({type:n,count:o})).sort((n,o)=>o.count-n.count).slice(0,5);b(a)}j(!1)}return f?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading stats..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-2",children:[h.name," Stats"]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Real-time knowledge graph statistics"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(T,{className:"w-4 h-4 text-[#a6ed2a]"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Contributions"})]}),e.jsx("div",{className:"text-2xl font-bold",children:c.contributions.toLocaleString()})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{className:"w-4 h-4 text-[#a6ed2a]"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Artifacts"})]}),e.jsx("div",{className:"text-2xl font-bold",children:c.artifacts.toLocaleString()})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"w-4 h-4 text-[#a6ed2a]"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Participants"})]}),e.jsx("div",{className:"text-2xl font-bold",children:c.participants.toLocaleString()})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"w-4 h-4 text-[#a6ed2a]"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Relationships"})]}),e.jsx("div",{className:"text-2xl font-bold",children:c.relationships.toLocaleString()})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_,{className:"w-4 h-4 text-[#a6ed2a]"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Sessions"})]}),e.jsx("div",{className:"text-2xl font-bold",children:c.sessions.toLocaleString()})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsx("h2",{className:"font-bold mb-3",children:"Top Dimensions"}),e.jsx("div",{className:"space-y-2",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:s.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-[#1d2839] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#a6ed2a]",style:{width:`${s.count/(d[0]?.count||1)*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-500 w-8 text-right",children:s.count})]})]},s.key))})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsx("h2",{className:"font-bold mb-3",children:"Top Artifact Types"}),e.jsx("div",{className:"space-y-2",children:m.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm capitalize",children:s.type}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-[#1d2839] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#a6ed2a]",style:{width:`${s.count/(m[0]?.count||1)*100}%`}})}),e.jsx("span",{className:"text-sm text-gray-500 w-8 text-right",children:s.count})]})]},s.type))})]})]}),e.jsx("div",{className:"text-center text-xs text-gray-600",children:"Updates in real-time as new contributions are processed"})]})}export{B as Stats};
