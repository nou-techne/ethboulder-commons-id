import{g as z,h as B,u as G,r as s,s as i,j as e,L as R}from"./index-Bg-tw-Nl.js";import{E as U}from"./ExtractionProgress-AmuoaNgc.js";import{Z as Y}from"./zap-DFyAfyV2.js";import{C as K}from"./check-BsieF5_Y.js";import{C as V}from"./clock-CFT00QrA.js";const J={e:{label:"Ecology",desc:"Environmental context, place, watershed, seasonal patterns"},H:{label:"Human",desc:"People, capabilities, relationships, lived experience"},L:{label:"Language",desc:"Shared vocabulary, frameworks, definitions"},A:{label:"Artifacts",desc:"Tools, documents, code, physical objects, infrastructure"},M:{label:"Methodology",desc:"Processes, workflows, practices, coordination patterns"},T:{label:"Training",desc:"Learning, skill development, transformation, practice"}},P="00000000-0000-0000-0000-000000000100";function ae(){const W=z(),[g]=B(),{convergence:n}=G(),b=n.opens_at?new Date(n.opens_at).getTime():0,[f,w]=s.useState(b<=Date.now()),[j,M]=s.useState(!1),[$,y]=s.useState("");s.useEffect(()=>{i.auth.getSession().then(({data:t})=>{t.session&&n.steward_ids?.includes(t.session.user.id)&&M(!0)})},[n.steward_ids]),s.useEffect(()=>{if(!n.opens_at){w(!0);return}function t(){const r=b-Date.now();if(r<=0){w(!0),y("");return}const l=Math.floor(r/36e5),c=Math.floor(r%36e5/6e4),d=Math.floor(r%6e4/1e3);y(`${l}h ${String(c).padStart(2,"0")}m ${String(d).padStart(2,"0")}s`)}t();const a=setInterval(t,1e3);return()=>clearInterval(a)},[n.opens_at]);const[m,v]=s.useState(""),[x,o]=s.useState("idle"),[O,N]=s.useState(Date.now()),[S,p]=s.useState(""),[u,k]=s.useState(null),[C,E]=s.useState(0),[_,A]=s.useState([]),[I,q]=s.useState([]),[D,L]=s.useState("");s.useEffect(()=>{F();const t=g.get("session");t&&L(t)},[g]);async function F(){const{data:t}=await i.from("sessions").select("id, title, time_start").eq("convergence_id",P).order("time_start",{ascending:!0,nullsFirst:!1});t&&q(t)}s.useEffect(()=>{if(!u)return;const t=i.channel(`contribution-${u}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"contributions",filter:`id=eq.${u}`},async a=>{const r=a.new.status;if(r==="processing")N(Date.now()),o("extracting");else if(r==="complete"){const l=a.new.extraction;if(l?.artifacts){E(l.artifacts.length);const c=l.artifacts.map(h=>h.title),{data:d}=await i.from("artifacts").select("id, title, type").in("title",c).order("created_at",{ascending:!1}).limit(10);A(d||[])}o("done")}else r==="error"&&(p("Extraction failed. Please try again."),o("error"))}).subscribe();return()=>{i.removeChannel(t)}},[u]);async function H(t){if(t.preventDefault(),!!m.trim()){o("submitting"),p("");try{const{data:{user:a}}=await i.auth.getUser();let r=null;if(a){const{data:d,error:h}=await i.from("participants").select("id").eq("auth_user_id",a.id).maybeSingle();if(h)throw h;if(d)r=d.id;else{const{data:Z,error:T}=await i.from("participants").insert({auth_user_id:a.id,name:a.email?.split("@")[0]||"Anonymous",email:a.email}).select("id").single();if(T)throw T;r=Z.id}}const{data:l,error:c}=await i.from("contributions").insert({content:m,convergence_id:P,participant_id:r,session_id:D||null,status:"pending"}).select("id").single();if(c)throw c;k(l.id),N(Date.now()),o("extracting")}catch(a){p(a?.message||"Something went wrong. Please try again."),o("error")}}}return x==="extracting"?e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#1d2839] flex items-center justify-center mx-auto mb-6 animate-pulse",children:e.jsx(Y,{className:"w-8 h-8 text-[#a6ed2a]"})}),e.jsx("h2",{className:"text-xl font-bold mb-3",children:"Extracting knowledge..."}),e.jsx("p",{className:"text-gray-400 max-w-md mx-auto",children:"AI is analyzing your contribution, identifying artifacts, tagging by dimension, and linking to the knowledge graph."}),e.jsx("div",{className:"mt-6",children:e.jsx(U,{startedAt:O})})]})}):x==="done"?e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#a6ed2a] flex items-center justify-center mx-auto mb-6",children:e.jsx(K,{className:"w-8 h-8 text-[#080c16]",strokeWidth:3})}),e.jsxs("h2",{className:"text-xl font-bold mb-3",children:["Done! ",C," ",C===1?"artifact":"artifacts"," created"]}),e.jsx("p",{className:"text-gray-400 mb-6 max-w-md mx-auto",children:"Your contribution has been processed and added to the knowledge graph."}),_.length>0&&e.jsxs("div",{className:"mb-8 max-w-md mx-auto",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Extracted artifacts:"}),e.jsx("div",{className:"space-y-2",children:_.map(t=>e.jsx(R,{to:`/artifact/${t.id}`,className:"block bg-[#0a101d] border border-[#1d2839] rounded-lg p-3 hover:border-[#a6ed2a] transition-colors text-left",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-[#1d2839] text-gray-400",children:t.type}),e.jsx("span",{className:"text-sm text-gray-300",children:t.title})]})},t.id))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx("button",{onClick:()=>{o("idle"),v(""),k(null),A([]),E(0)},className:"px-6 py-2.5 bg-[#1d2839] text-white rounded-lg hover:bg-[#283347] transition-colors text-sm",children:"Contribute more"}),e.jsx("button",{onClick:()=>W("/"),className:"px-6 py-2.5 bg-[#a6ed2a] text-[#080c16] rounded-lg hover:bg-[#b8f247] transition-colors text-sm",children:"Explore"})]})]})}):!f&&!j?e.jsxs("div",{className:"max-w-2xl mx-auto text-center py-16",children:[e.jsx(V,{className:"w-16 h-16 text-blue-500 mx-auto mb-6"}),e.jsx("h1",{className:"text-3xl font-bold mb-3",children:"Knowledge Graph Opening Soon"}),e.jsxs("p",{className:"text-gray-400 mb-6",children:["The ",n.name," knowledge graph opens when the convergence begins. Contributions will be accepted once the chain is live."]}),e.jsx("div",{className:"inline-flex items-center gap-2 bg-[#0a101d] border border-blue-500/30 rounded-xl px-8 py-4",children:e.jsx("div",{className:"text-3xl font-mono font-bold text-white",children:$})}),e.jsx("p",{className:"text-gray-600 text-xs mt-6",children:n.opens_at&&new Date(n.opens_at).toLocaleString(void 0,{weekday:"long",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",timeZoneName:"short"})})]}):e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Contribute"}),j&&!f&&e.jsx("span",{className:"text-xs px-2.5 py-1 rounded-full bg-amber-900/30 border border-amber-700/30 text-amber-400",children:"Steward Access"})]}),e.jsx("p",{className:"text-gray-400 text-sm mb-2",children:"Share what you observed, learned, or committed to. Write naturally — AI extracts the structure."}),e.jsxs("p",{className:"text-gray-500 text-xs mb-4",children:["First time? ",e.jsx("a",{href:"/app/welcome",className:"text-[#a6ed2a] hover:underline",children:"See how it works"})]}),e.jsxs("details",{className:"mb-6 bg-[#0a101d] border border-[#1d2839] rounded-lg overflow-hidden",open:typeof window<"u"?localStorage.getItem("hlamt-open")!=="false":!0,onToggle:t=>localStorage.setItem("hlamt-open",String(t.target.open)),children:[e.jsxs("summary",{className:"px-4 py-3 text-base font-medium text-white cursor-pointer hover:bg-[#1d2839] transition-colors flex items-center justify-between list-none [&::-webkit-details-marker]:hidden",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400 transition-transform duration-200 hlamt-chevron",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m9 18 6-6-6-6"})}),e.jsx("span",{children:"What is e/H-LAM/T/S?"})]}),e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"AI classifies every contribution across these seven dimensions"})]}),e.jsx("div",{className:"px-4 pb-4 pt-2 grid grid-cols-2 md:grid-cols-3 gap-2",children:Object.entries(J).map(([t,{label:a,desc:r}])=>e.jsxs("div",{className:"bg-[#080c16] border border-[#1d2839] rounded-lg p-3",children:[e.jsxs("div",{className:"text-sm font-mono text-[#a6ed2a] mb-1 font-bold",children:[t,"/"]}),e.jsx("div",{className:"text-sm font-medium text-white mb-1",children:a}),e.jsx("div",{className:"text-xs text-gray-400 leading-relaxed",children:r})]},t))})]}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[I.length>0&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"session-select",className:"block text-sm font-medium text-gray-300 mb-2",children:"Session (optional)"}),e.jsxs("select",{id:"session-select",value:D,onChange:t=>L(t.target.value),className:"w-full bg-[#0a101d] border border-[#1d2839] rounded-lg px-4 py-2 text-white focus:outline-none focus:border-[#a6ed2a]",children:[e.jsx("option",{value:"",children:"No session"}),I.map(t=>e.jsxs("option",{value:t.id,children:[t.title,t.time_start&&` — ${new Date(t.time_start).toLocaleDateString()}`]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contribution-text",className:"sr-only",children:"Your contribution"}),e.jsx("textarea",{id:"contribution-text",value:m,onChange:t=>v(t.target.value),placeholder:`What happened? What did you learn? What are you going to do about it?

Write about a session you just attended, an idea someone sparked, a commitment you're making, or a pattern you're noticing across conversations.

A paragraph or two is ideal. Name people and projects when you can — it helps build the graph.`,rows:12,required:!0,className:"w-full bg-[#0a101d] border border-[#1d2839] rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] resize-y leading-relaxed text-base"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between gap-1 sm:gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"AI classifies contribution type, extracts artifacts, and records relationships automatically."}),e.jsxs("span",{className:"text-xs text-gray-500",children:[m.length," chars"]})]})]}),S&&e.jsx("div",{className:"p-3 bg-red-900/20 border border-red-800/30 rounded-lg text-sm text-red-300",children:S}),e.jsx("button",{type:"submit",disabled:x==="submitting"||!m.trim(),className:"w-full bg-[#a6ed2a] text-[#080c16] hover:bg-[#b8f247] py-3 rounded-lg transition-colors disabled:opacity-50",children:x==="submitting"?"Saving...":"Submit to the Commons"})]})]})}export{ae as Contribute};
