import{r as n,j as e,s as i,e as G,L as b,A as S,R as F,a as C,b as W,d as L,S as Y}from"./index-C1rFkvFB.js";import{H as E}from"./handshake-C07NLiwi.js";import{C as T}from"./chevron-right-BQouldc4.js";import{M as U}from"./message-square-Dze7Ssj-.js";import{L as z}from"./link-2-D8ogweOr.js";function J({artifactId:o,participantId:t,compact:y=!1}){const[c,x]=n.useState(!1),[d,f]=n.useState(0),[m,g]=n.useState(!1);n.useEffect(()=>{async function l(){const{count:h}=await i.from("coordination_interests").select("*",{count:"exact",head:!0}).eq("artifact_id",o);if(f(h||0),t){const{data:j}=await i.from("coordination_interests").select("id").eq("artifact_id",o).eq("participant_id",t).maybeSingle();x(!!j)}}l()},[o,t]);async function u(){if(!(!t||m)){g(!0);try{c?(await i.from("coordination_interests").delete().eq("artifact_id",o).eq("participant_id",t),x(!1),f(l=>Math.max(0,l-1))):(await i.from("coordination_interests").insert({artifact_id:o,participant_id:t}),x(!0),f(l=>l+1))}catch(l){console.error("Coordinate toggle error:",l)}g(!1)}}return y?e.jsxs("button",{onClick:l=>{l.preventDefault(),l.stopPropagation(),u()},disabled:!t||m,className:`inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full transition-colors ${c?"bg-[#a6ed2a]/20 text-[#a6ed2a] border border-[#a6ed2a]/30":"bg-[#1d2839] text-gray-400 hover:text-[#a6ed2a] hover:bg-[#a6ed2a]/10"} ${t?"":"opacity-50 cursor-not-allowed"}`,title:t?c?"Remove coordination interest":"I want to coordinate on this":"Sign in to coordinate",children:[e.jsx(E,{className:"w-3 h-3"}),d>0&&e.jsx("span",{children:d})]}):e.jsxs("button",{onClick:u,disabled:!t||m,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-sm ${c?"bg-[#a6ed2a]/20 text-[#a6ed2a] border border-[#a6ed2a]/30":"bg-[#1d2839] text-gray-300 hover:text-[#a6ed2a] hover:bg-[#a6ed2a]/10"} ${t?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:c?"Coordinating":"Coordinate"}),d>0&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-[#1d2839] text-xs",children:d})]})}const K={"hlamt:e":{letter:"e/",name:"Ecology",color:"#4a8c6f"},"hlamt:E":{letter:"e/",name:"Ecology",color:"#4a8c6f"},"hlamt:H":{letter:"H/",name:"Human",color:"#c4956a"},"hlamt:L":{letter:"L/",name:"Language",color:"#a6ed2a"},"hlamt:A":{letter:"A/",name:"Artifacts",color:"#8bbfff"},"hlamt:M":{letter:"M/",name:"Methodology",color:"#7ccfb8"},"hlamt:T":{letter:"T/",name:"Training",color:"#e8927c"}};function q(o){const t=Math.floor((Date.now()-new Date(o).getTime())/1e3);return t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}function ee(){const{id:o}=G(),[t,y]=n.useState(null),[c,x]=n.useState([]),[d,f]=n.useState([]),[m,g]=n.useState([]),[u,l]=n.useState([]),[h,j]=n.useState(null),[N,R]=n.useState(null),[M,_]=n.useState(!0),[k,$]=n.useState(null);n.useEffect(()=>{o&&(D(),i.auth.getUser().then(async({data:{user:s}})=>{if(s){const{data:r}=await i.from("participants").select("id").eq("auth_user_id",s.id).maybeSingle();r&&$(r.id)}}))},[o]);async function D(){_(!0);const{data:s}=await i.from("artifacts").select("*").eq("id",o).single();if(!s){_(!1);return}y(s);const{data:r}=await i.from("artifact_tags").select("tags(name)").eq("artifact_id",o),p=(r||[]).map(a=>a.tags?.name).filter(Boolean);if(f(p.filter(a=>a.startsWith("hlamt:"))),x(p.filter(a=>!a.startsWith("hlamt:"))),s.steward_id){const{data:a}=await i.from("participants").select("id, name").eq("id",s.steward_id).single();a&&j(a)}const[{data:H},{data:B}]=await Promise.all([i.from("artifact_relationships").select("*, to_artifact_id").eq("from_artifact_id",o),i.from("artifact_relationships").select("*, from_artifact_id").eq("to_artifact_id",o)]),w=[...(H||[]).map(a=>({...a,direction:"to",related_id:a.to_artifact_id})),...(B||[]).map(a=>({...a,direction:"from",related_id:a.from_artifact_id}))];if(g(w),w.length>0){const a=w.map(P=>P.related_id),{data:v}=await i.from("artifacts").select("*").in("id",a);l(v||[])}const{data:O}=await i.from("contributions").select("id, content, created_at, extraction").eq("status","complete").order("created_at",{ascending:!1}).limit(20),A=O?.find(a=>a.extraction?.artifacts?a.extraction.artifacts.some(v=>v.title===s.title):!1);A&&R(A),_(!1)}return M?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):t?e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("nav",{className:"flex items-center gap-1.5 text-sm mb-4",children:[e.jsx(b,{to:"/",className:"text-gray-400 hover:text-white transition-colors",children:"Explore"}),e.jsx(T,{className:"w-3.5 h-3.5 text-gray-600"}),e.jsx("span",{className:"text-gray-400",children:"Graph Index"}),e.jsx(T,{className:"w-3.5 h-3.5 text-gray-600"}),e.jsx("span",{className:"text-white truncate max-w-[200px]",children:t.title})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:S[t.type]}}),e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:S[t.type]},children:t.type}),t.rea_role&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded border font-medium",style:{color:C[t.rea_role],borderColor:C[t.rea_role]+"40"},children:F[t.rea_role]}),t.agent_type&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded border font-medium",style:{color:L[t.agent_type],borderColor:L[t.agent_type]+"40"},children:W[t.agent_type]}),e.jsx("span",{className:"text-xs text-gray-500",children:Y[t.state]}),t.created_by_agent&&e.jsx("span",{className:"text-xs bg-[#1d2839] text-gray-400 px-2 py-0.5 rounded",children:"AI-extracted"}),e.jsx("span",{className:"ml-auto text-xs text-gray-600",children:q(t.created_at)})]}),e.jsx("h1",{className:"text-2xl font-bold mb-3 leading-tight",children:t.title}),t.summary&&e.jsx("p",{className:"text-gray-300 mb-4 leading-relaxed",children:t.summary}),e.jsx("div",{className:"mb-4",children:e.jsx(J,{artifactId:t.id,participantId:k})}),t.body&&e.jsx("div",{className:"text-sm text-gray-400 mb-4 whitespace-pre-wrap leading-relaxed border-t border-[#1d2839] pt-4",children:t.body}),d.length>0&&e.jsxs("div",{className:"mb-4 pb-4 border-b border-[#1d2839]",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Dimensions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(s=>{const r=K[s];return r?e.jsxs("span",{className:"px-2 py-1 rounded text-xs border",style:{color:r.color,borderColor:r.color+"40"},children:[e.jsx("span",{className:"font-mono font-semibold",children:r.letter})," ",r.name]},s):null})})]}),c.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(s=>e.jsx("span",{className:"bg-[#1d2839] text-gray-300 text-xs px-2 py-1 rounded",children:s},s))})]}),e.jsxs("div",{className:"text-xs text-gray-600 pt-4 border-t border-[#1d2839] space-y-1",children:[h&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Steward:"})," ",e.jsx(b,{to:`/p/${h.id}`,className:"text-gray-400 hover:text-[#a6ed2a] transition-colors",children:h.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"ID:"})," ",e.jsx("span",{className:"font-mono",children:t.id.slice(0,13)})]})]})]}),N&&e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6 mb-6",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Source Contribution"]}),e.jsx(b,{to:"/me",className:"block text-sm text-gray-400 hover:text-white line-clamp-3 mb-2",children:N.content}),e.jsx("div",{className:"text-xs text-gray-600",children:q(N.created_at)})]}),m.length>0&&e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Related Artifacts"]}),e.jsx("div",{className:"space-y-2",children:m.map(s=>{const r=u.find(p=>p.id===s.related_id);return r?e.jsxs(b,{to:`/artifact/${r.id}`,className:"block bg-[#080c16] border border-[#1d2839] rounded-lg p-3 hover:border-[#a6ed2a] transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:S[r.type]}}),e.jsx("span",{className:"text-xs uppercase text-gray-500",children:r.type}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Â· ",s.type.replace(/_/g," ")]})]}),e.jsx("div",{className:"text-sm text-white group-hover:text-[#a6ed2a] transition-colors font-medium",children:r.title}),r.summary&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:r.summary})]},s.id):null})})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Artifact not found"})}export{ee as ArtifactDetail};
