import{e as $,r as l,s as i,j as e,L as c,A as h,R as H,a as j,b as P,d as N,S as G}from"./index-DMonaj-y.js";import{C as F}from"./CoordinateButton-B7UZJu6H.js";import{C as _}from"./chevron-right-BOIFnP4B.js";import{M as W}from"./message-square-BWqwvPd2.js";import{L as Y}from"./link-2-BHR6Oleo.js";import"./handshake-DwTesg8Y.js";const U={"hlamt:e":{letter:"e/",name:"Ecology",color:"#4a8c6f"},"hlamt:E":{letter:"e/",name:"Ecology",color:"#4a8c6f"},"hlamt:H":{letter:"H/",name:"Human",color:"#c4956a"},"hlamt:L":{letter:"L/",name:"Language",color:"#a6ed2a"},"hlamt:A":{letter:"A/",name:"Artifacts",color:"#8bbfff"},"hlamt:M":{letter:"M/",name:"Methodology",color:"#7ccfb8"},"hlamt:T":{letter:"T/",name:"Training",color:"#e8927c"},"hlamt:S":{letter:"S/",name:"Sessions",color:"#c084fc"}};function w(o){const t=Math.floor((Date.now()-new Date(o).getTime())/1e3);return t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}function ee(){const{id:o}=$(),[t,v]=l.useState(null),[g,S]=l.useState([]),[u,A]=l.useState([]),[b,L]=l.useState([]),[T,E]=l.useState([]),[d,C]=l.useState(null),[m,R]=l.useState(null),[M,x]=l.useState(!0),[z,q]=l.useState(null);l.useEffect(()=>{o&&(I(),i.auth.getUser().then(async({data:{user:s}})=>{if(s){const{data:r}=await i.from("participants").select("id").eq("auth_user_id",s.id).maybeSingle();r&&q(r.id)}}))},[o]);async function I(){x(!0);const{data:s}=await i.from("artifacts").select("*").eq("id",o).single();if(!s){x(!1);return}v(s);const{data:r}=await i.from("artifact_tags").select("tags(name)").eq("artifact_id",o),n=(r||[]).map(a=>a.tags?.name).filter(Boolean);if(A(n.filter(a=>a.startsWith("hlamt:"))),S(n.filter(a=>!a.startsWith("hlamt:"))),s.steward_id){const{data:a}=await i.from("public_participants").select("id, name").eq("id",s.steward_id).single();a&&C(a)}const[{data:k},{data:B}]=await Promise.all([i.from("artifact_relationships").select("*, to_artifact_id").eq("from_artifact_id",o),i.from("artifact_relationships").select("*, from_artifact_id").eq("to_artifact_id",o)]),p=[...(k||[]).map(a=>({...a,direction:"to",related_id:a.to_artifact_id})),...(B||[]).map(a=>({...a,direction:"from",related_id:a.from_artifact_id}))];if(L(p),p.length>0){const a=p.map(O=>O.related_id),{data:f}=await i.from("artifacts").select("*").in("id",a);E(f||[])}const{data:D}=await i.from("contributions").select("id, content, created_at, extraction").eq("status","complete").order("created_at",{ascending:!1}).limit(20),y=D?.find(a=>a.extraction?.artifacts?a.extraction.artifacts.some(f=>f.title===s.title):!1);y&&R(y),x(!1)}return M?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):t?e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("nav",{className:"flex items-center gap-1.5 text-sm mb-4",children:[e.jsx(c,{to:"/",className:"text-gray-400 hover:text-white transition-colors",children:"Explore"}),e.jsx(_,{className:"w-3.5 h-3.5 text-gray-600"}),e.jsx("span",{className:"text-gray-400",children:"Graph Index"}),e.jsx(_,{className:"w-3.5 h-3.5 text-gray-600"}),e.jsx("span",{className:"text-white truncate max-w-[200px]",children:t.title})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[e.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:h[t.type]}}),e.jsx("span",{className:"text-xs uppercase tracking-wider",style:{color:h[t.type]},children:t.type}),t.rea_role&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded border font-medium",style:{color:j[t.rea_role],borderColor:j[t.rea_role]+"40"},children:H[t.rea_role]}),t.agent_type&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded border font-medium",style:{color:N[t.agent_type],borderColor:N[t.agent_type]+"40"},children:P[t.agent_type]}),e.jsx("span",{className:"text-xs text-gray-500",children:G[t.state]}),t.created_by_agent&&e.jsx("span",{className:"text-xs bg-[#1d2839] text-gray-400 px-2 py-0.5 rounded",children:"AI-extracted"}),e.jsx("span",{className:"ml-auto text-xs text-gray-600",children:w(t.created_at)})]}),e.jsx("h1",{className:"text-2xl font-bold mb-3 leading-tight",children:t.title}),t.summary&&e.jsx("p",{className:"text-gray-300 mb-4 leading-relaxed",children:t.summary}),e.jsx("div",{className:"mb-4",children:e.jsx(F,{artifactId:t.id})}),t.body&&e.jsx("div",{className:"text-sm text-gray-400 mb-4 whitespace-pre-wrap leading-relaxed border-t border-[#1d2839] pt-4",children:t.body}),u.length>0&&e.jsxs("div",{className:"mb-4 pb-4 border-b border-[#1d2839]",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Dimensions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(s=>{const r=U[s];return r?e.jsxs("span",{className:"px-2 py-1 rounded text-xs border",style:{color:r.color,borderColor:r.color+"40"},children:[e.jsx("span",{className:"font-mono font-semibold",children:r.letter})," ",r.name]},s):null})})]}),g.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(s=>e.jsx("span",{className:"bg-[#1d2839] text-gray-300 text-xs px-2 py-1 rounded",children:s},s))})]}),e.jsxs("div",{className:"text-xs text-gray-600 pt-4 border-t border-[#1d2839] space-y-1",children:[d&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Steward:"})," ",e.jsx(c,{to:`/p/${d.id}`,className:"text-gray-400 hover:text-[#a6ed2a] transition-colors",children:d.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"ID:"})," ",e.jsx("span",{className:"font-mono",children:t.id.slice(0,13)})]})]})]}),m&&e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6 mb-6",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Source Contribution"]}),e.jsx(c,{to:"/me",className:"block text-sm text-gray-400 hover:text-white line-clamp-3 mb-2",children:m.content}),e.jsx("div",{className:"text-xs text-gray-600",children:w(m.created_at)})]}),b.length>0&&e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Related Artifacts"]}),e.jsx("div",{className:"space-y-2",children:b.map(s=>{const r=T.find(n=>n.id===s.related_id);return r?e.jsxs(c,{to:`/artifact/${r.id}`,className:"block bg-[#080c16] border border-[#1d2839] rounded-lg p-3 hover:border-[#a6ed2a] transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:h[r.type]}}),e.jsx("span",{className:"text-xs uppercase text-gray-500",children:r.type}),e.jsxs("span",{className:"text-xs text-gray-600",children:["Â· ",s.type.replace(/_/g," ")]})]}),e.jsx("div",{className:"text-sm text-white group-hover:text-[#a6ed2a] transition-colors font-medium",children:r.title}),r.summary&&e.jsx("div",{className:"text-xs text-gray-500 mt-1 line-clamp-2",children:r.summary})]},s.id):null})})]})]}):e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Artifact not found"})}export{ee as ArtifactDetail};
