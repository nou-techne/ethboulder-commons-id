import{c as v,r as s,s as i,j as e}from"./index-DMonaj-y.js";import{C as N}from"./circle-alert-DL5PfVID.js";import{P as $}from"./plus-BEFdCwWv.js";import{C as L}from"./check-CARfCKV0.js";import{T as M}from"./trash-2-I8cionWm.js";const R=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],q=v("copy",R);const E=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],w=v("key",E);function T(n){if(!n)return"Never";const a=Math.floor((Date.now()-new Date(n).getTime())/1e3);return a<60?`${a}s ago`:a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`}function B(){const[n,a]=s.useState([]),[k,_]=s.useState(!0),[l,u]=s.useState(null),[C,x]=s.useState(!1),[o,f]=s.useState(""),[p,K]=s.useState(1e3),[g,m]=s.useState(!1),[c,y]=s.useState(null),[b,j]=s.useState(!1);s.useEffect(()=>{i.auth.getSession().then(({data:r})=>u(r.session));const{data:{subscription:t}}=i.auth.onAuthStateChange((r,d)=>u(d));return()=>t.unsubscribe()},[]),s.useEffect(()=>{l&&h()},[l]);async function h(){const{data:t}=await i.from("api_keys").select("*").order("created_at",{ascending:!1});a(t||[]),_(!1)}async function S(){if(!l||!o.trim())return;m(!0);const{data:t}=await i.from("participants").select("id").eq("auth_id",l.user.id).single();if(!t){alert("Participant profile not found"),m(!1);return}const{data:r,error:d}=await i.rpc("create_api_key",{p_participant_id:t.id,p_name:o.trim(),p_rate_limit:p,p_environment:"live"});d?alert(`Error: ${d.message}`):r&&r.length>0&&(y(r[0].api_key),f(""),await h()),m(!1)}async function A(t){if(!confirm(`Revoke API key ${t}? This cannot be undone.`))return;const{error:r}=await i.rpc("revoke_api_key",{p_key_prefix:t});r?alert(`Error: ${r.message}`):await h()}function P(){c&&(navigator.clipboard.writeText(c),j(!0),setTimeout(()=>j(!1),2e3))}function I(){y(null),x(!1)}return k?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):l?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:"API Keys"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Manage API keys for programmatic access"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 bg-[#a6ed2a] text-[#080c16] px-4 py-2 rounded-lg font-medium hover:bg-[#b8f247] transition-colors text-sm",children:[e.jsx($,{className:"w-4 h-4"}),"New Key"]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-6 max-w-lg w-full",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(N,{className:"w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white mb-1",children:"Save Your API Key"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Copy this key now. You won't be able to see it again!"})]})]}),e.jsx("div",{className:"bg-[#080c16] border border-[#1d2839] rounded-lg p-3 mb-4",children:e.jsx("code",{className:"text-[#a6ed2a] text-sm break-all",children:c})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:P,className:"flex-1 flex items-center justify-center gap-2 bg-[#1d2839] text-white px-4 py-2 rounded-lg hover:bg-[#2a3a4f] transition-colors text-sm",children:[b?e.jsx(L,{className:"w-4 h-4"}):e.jsx(q,{className:"w-4 h-4"}),b?"Copied!":"Copy Key"]}),e.jsx("button",{onClick:I,className:"flex-1 bg-[#a6ed2a] text-[#080c16] px-4 py-2 rounded-lg font-medium hover:bg-[#b8f247] transition-colors text-sm",children:"Done"})]})]})}),C&&!c&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-6 max-w-md w-full",children:[e.jsx("h2",{className:"text-lg font-bold text-white mb-4",children:"Create API Key"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Name"}),e.jsx("input",{value:o,onChange:t=>f(t.target.value),placeholder:"My Agent Key",className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Rate Limit (requests/hour)"}),e.jsx("input",{type:"number",value:p,onChange:t=>K(parseInt(t.target.value)||1e3),min:"100",max:"10000",className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white focus:outline-none focus:border-[#a6ed2a] text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 1000 req/hr"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 bg-[#1d2839] text-white px-4 py-2 rounded-lg hover:bg-[#2a3a4f] transition-colors text-sm",children:"Cancel"}),e.jsx("button",{onClick:S,disabled:!o.trim()||g,className:"flex-1 bg-[#a6ed2a] text-[#080c16] px-4 py-2 rounded-lg font-medium hover:bg-[#b8f247] transition-colors text-sm disabled:opacity-50",children:g?"Creating...":"Create"})]})]})}),n.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(w,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No API keys yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create your first API key to get started"})]}):e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsx("div",{className:`bg-[#0a101d] border rounded-lg p-4 ${t.revoked_at?"border-red-900/50 opacity-60":"border-[#1d2839]"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-white",children:t.name||"Unnamed Key"}),t.revoked_at&&e.jsx("span",{className:"text-xs bg-red-900/30 text-red-400 px-2 py-0.5 rounded",children:"Revoked"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("code",{className:"text-[#a6ed2a]",children:[t.key_prefix,"..."]}),e.jsxs("span",{children:[t.rate_limit_per_hour," req/hr"]}),e.jsxs("span",{children:["Last used: ",T(t.last_used_at)]})]})]}),!t.revoked_at&&e.jsx("button",{onClick:()=>A(t.key_prefix),className:"text-gray-400 hover:text-red-400 transition-colors ml-4",title:"Revoke key",children:e.jsx(M,{className:"w-4 h-4"})})]})},t.id))})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(N,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Sign in to manage API keys"})]})}export{B as ApiKeysPage};
