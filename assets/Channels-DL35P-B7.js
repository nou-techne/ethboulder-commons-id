import{c as A,u as R,r as a,s as o,j as e,X as V,L as B}from"./index-DMonaj-y.js";import{P as H}from"./plus-BEFdCwWv.js";import{H as k}from"./hash-D2O0A6Fo.js";const I=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],O=A("lock",I),S=["general","dimension","session","topic","meta"],_={general:"General",dimension:"Dimensions",session:"Sessions",topic:"Topics",meta:"Meta"};function W(c){const n=Math.floor((Date.now()-new Date(c).getTime())/1e3);return n<60?`${n}s ago`:n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:`${Math.floor(n/86400)}d ago`}function U(){const{convergence:c}=R(),[n,L]=a.useState([]),[D,E]=a.useState(!0),[d,u]=a.useState(null),[M,l]=a.useState(!1),[r,g]=a.useState(""),[p,b]=a.useState(""),[f,j]=a.useState("general"),[w,T]=a.useState("public"),[y,N]=a.useState(!1),[P,$]=a.useState(new Set);a.useEffect(()=>{o.auth.getSession().then(({data:t})=>u(t.session));const{data:{subscription:s}}=o.auth.onAuthStateChange((t,x)=>u(x));return()=>s.unsubscribe()},[]),a.useEffect(()=>{v()},[]);async function v(){const{data:s}=await o.from("channels").select("*").order("position",{ascending:!0}).order("created_at",{ascending:!0}),t=s||[];L(t);const x=JSON.parse(localStorage.getItem("channel_last_read")||"{}"),m=new Set;for(const i of t){const h=x[i.slug];h&&new Date(i.updated_at)>new Date(h)?m.add(i.slug):h||m.add(i.slug)}$(m),E(!1)}async function z(){if(!r.trim()||!d)return;N(!0);const s=r.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),{error:t}=await o.from("channels").insert({name:r.trim(),slug:s,description:p.trim()||null,type:f,visibility:w,convergence_id:c.id,created_by:d.user.id});t||(g(""),b(""),j("general"),l(!1),await v()),N(!1)}const C=S.map(s=>({type:s,label:_[s],channels:n.filter(t=>t.type===s)})).filter(s=>s.channels.length>0);return D?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Channels"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Discussion spaces organized by topic and purpose."})]}),d&&e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 bg-[#a6ed2a] text-[#080c16] font-medium px-4 py-2 rounded-lg hover:bg-[#b8f247] transition-colors text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"New Channel"]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:()=>l(!1),children:e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6 w-full max-w-md",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"New Channel"}),e.jsx("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-white",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Name"}),e.jsx("input",{value:r,onChange:s=>g(s.target.value),placeholder:"channel-name",className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:p,onChange:s=>b(s.target.value),placeholder:"What's this channel about?",rows:2,className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Type"}),e.jsx("select",{value:f,onChange:s=>j(s.target.value),className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white text-sm",children:S.map(s=>e.jsx("option",{value:s,children:_[s]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Visibility"}),e.jsxs("select",{value:w,onChange:s=>T(s.target.value),className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white text-sm",children:[e.jsx("option",{value:"public",children:"Public — Anyone can view"}),e.jsx("option",{value:"members",children:"Members — Authenticated users only"})]})]}),e.jsx("button",{onClick:z,disabled:!r.trim()||y,className:"w-full bg-[#a6ed2a] text-[#080c16] font-medium py-2 rounded-lg hover:bg-[#b8f247] transition-colors text-sm disabled:opacity-50",children:y?"Creating...":"Create Channel"})]})]})}),C.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(k,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No channels yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create the first channel to start discussions."})]}):e.jsx("div",{className:"space-y-6",children:C.map(s=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:s.label}),e.jsx("div",{className:"space-y-1",children:s.channels.map(t=>e.jsxs(B,{to:`/channels/${t.slug}`,className:"flex items-center gap-3 bg-[#0a101d] border border-[#1d2839] rounded-lg px-4 py-4 hover:border-[#a6ed2a] transition-colors group",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-[#1d2839] flex items-center justify-center text-gray-400 group-hover:text-[#a6ed2a] group-hover:bg-[#1d2839]/80 transition-colors",children:t.visibility==="members"||t.visibility==="admin"?e.jsx(O,{className:"w-5 h-5"}):e.jsx(k,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-white text-base group-hover:text-[#a6ed2a] transition-colors",children:t.name}),P.has(t.slug)&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-500 flex-shrink-0"})]}),t.description?e.jsx("p",{className:"text-sm text-gray-400 truncate mt-0.5",children:t.description}):e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"No description"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-gray-500",children:W(t.updated_at)}),e.jsx("svg",{className:"w-4 h-4 text-gray-600 group-hover:text-[#a6ed2a]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m9 18 6-6-6-6"})})]})]},t.id))})]},s.type))})]})}export{U as Channels};
