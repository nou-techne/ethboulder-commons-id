import{c as O,r as l,s as o,j as e,L as d,f as U,C as G,A as w,R as C,a as _,S as k}from"./index-CBgAWxJw.js";import{P as I}from"./plus-BnOs8FEl.js";import{C as V}from"./clock-qkWA5Amp.js";import{F as A}from"./file-text-CSOMogRk.js";import{G as Y}from"./git-branch-azh6yor2.js";const z=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],H=O("target",z);function J(m){const n=Math.floor((Date.now()-new Date(m).getTime())/1e3);return n<60?`${n}s ago`:n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:`${Math.floor(n/86400)}d ago`}function ee(){const[m,n]=l.useState(null),[u,S]=l.useState(null),[h,$]=l.useState([]),[p,E]=l.useState([]),[x,L]=l.useState([]),[j,N]=l.useState(null),[g,y]=l.useState({});l.useEffect(()=>{o.auth.getSession().then(({data:s})=>{if(n(s.session),!s.session){b(null);return}T(s.session.user.id)});const t=o.channel("my-contributions").on("postgres_changes",{event:"*",schema:"public",table:"contributions"},()=>{b(u)}).subscribe();return()=>{o.removeChannel(t)}},[]),l.useEffect(()=>{u!==null&&b(u)},[u]);async function b(t){let s=o.from("contributions").select("id, content, title, status, created_at, processed_at, extraction").order("created_at",{ascending:!1}).limit(30);t&&(s=s.eq("participant_id",t));const{data:r}=await s;L(r||[])}async function T(t){const{data:s}=await o.from("participants").select("id").eq("auth_user_id",t).single();if(!s)return;S(s.id);const[{data:r},{data:c}]=await Promise.all([o.from("artifacts").select("*").or(`created_by.eq.${s.id},steward_id.eq.${s.id}`).order("created_at",{ascending:!1}).limit(50),o.from("commitments").select("*").eq("participant_id",s.id).order("created_at",{ascending:!1})]);$(r||[]),E(c||[])}async function M(t){if(g[t])return;const r=x.find(i=>i.id===t)?.extraction?.artifacts?.map(i=>i.title).filter(Boolean)||[];if(r.length===0){y(i=>({...i,[t]:[]}));return}const{data:c}=await o.from("artifacts").select("*").in("title",r).order("created_at",{ascending:!0});y(i=>({...i,[t]:c||[]}))}function P(t){j===t?N(null):(N(t),M(t))}const v={pending:{label:"Pending",color:"text-yellow-300",bg:"bg-yellow-900/30"},processing:{label:"Extracting...",color:"text-blue-300",bg:"bg-blue-900/30"},complete:{label:"Complete",color:"text-green-300",bg:"bg-green-900/30"},error:{label:"Error",color:"text-red-300",bg:"bg-red-900/30"}},D=x.length,R=x.filter(t=>t.status==="complete").length,q=h.length,F=p.length;return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"My Activity"}),e.jsx("p",{className:"text-gray-400 text-sm",children:m?"Your contributions, artifacts, and commitments in one place.":"All contributions across the commons."})]}),e.jsxs(d,{to:"/contribute",className:"bg-[#a6ed2a] text-[#080c16] hover:bg-[#b8f247] px-4 py-2 rounded-lg text-sm transition-colors inline-flex items-center gap-1.5",children:[e.jsx(I,{className:"w-4 h-4"})," Contribute"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:D}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Contributions"})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-[#a6ed2a]",children:q}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Artifacts Created"})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:F}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Commitments"})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:R}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Processed"})]})]}),!m&&e.jsxs("div",{className:"bg-[#0a101d] border border-[#a6ed2a]/30 rounded-lg p-4 mb-6 text-sm text-gray-400",children:[e.jsx(d,{to:"/auth",className:"text-[#a6ed2a] hover:text-white font-medium",children:"Sign in"})," to see only your activity and track your contributions over time."]}),p.length>0&&e.jsxs("section",{className:"mb-8",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-amber-400"}),"Commitments"]}),e.jsx("div",{className:"space-y-2",children:p.map(t=>e.jsx("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-white",children:t.description}),t.due_date&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 text-xs text-gray-500",children:[e.jsx(V,{className:"w-3 h-3"}),"Due: ",new Date(t.due_date).toLocaleDateString()]})]}),e.jsx("span",{className:`text-xs px-2.5 py-1 rounded-full font-medium flex-shrink-0 ${t.status==="fulfilled"?"bg-green-900/30 text-green-300":t.status==="in_progress"?"bg-blue-900/30 text-blue-300":t.status==="broken"?"bg-red-900/30 text-red-300":"bg-gray-800 text-gray-400"}`,children:t.status==="in_progress"?"In Progress":t.status.charAt(0).toUpperCase()+t.status.slice(1)})]})},t.id))})]}),e.jsxs("section",{className:"mb-8",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-[#a6ed2a]"}),"Contributions"]}),x.length===0?e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-8 text-center",children:[e.jsx(A,{className:"w-10 h-10 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400 font-medium",children:"No contributions yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 mb-4",children:"Share an observation, idea, or commitment and it will appear here."}),e.jsx(d,{to:"/contribute",className:"inline-block bg-[#a6ed2a] text-[#080c16] px-6 py-2 rounded-lg hover:bg-[#b8f247] text-sm",children:"Make your first contribution"})]}):e.jsx("div",{className:"space-y-2",children:x.map(t=>{const s=v[t.status]||v.pending,r=t.extraction||{},c=r.artifacts?.length||0,i=r.relationships?.length||0,f=j===t.id;return e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg overflow-hidden",children:[e.jsxs("div",{onClick:()=>t.status==="complete"?P(t.id):void 0,className:`w-full text-left p-4 ${t.status==="complete"?"cursor-pointer hover:bg-[#222]":""} transition-colors`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-2 h-2 rounded-full flex-shrink-0 ${t.status==="complete"?"bg-[#a6ed2a]":t.status==="processing"?"bg-blue-400 animate-pulse":t.status==="error"?"bg-red-400":"bg-yellow-400"}`}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s.bg} ${s.color}`,children:s.label}),t.status==="complete"&&c>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"text-[#a6ed2a] font-mono font-medium",children:c})," ",c===1?"node":"nodes",i>0&&e.jsxs(e.Fragment,{children:[" Â· ",e.jsx("span",{className:"text-[#a6ed2a] font-mono font-medium",children:i})," ",i===1?"edge":"edges"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:J(t.created_at)}),t.status==="complete"&&(f?e.jsx(U,{className:"w-4 h-4 text-gray-500"}):e.jsx(G,{className:"w-4 h-4 text-gray-500"}))]})]}),t.title&&e.jsx("p",{className:"text-sm font-medium text-white mb-1",children:t.title}),e.jsx("p",{className:`text-xs text-gray-400 ${f?"":"line-clamp-2"}`,children:t.content}),t.status==="complete"&&e.jsx(d,{to:`/contribution/${t.id}`,className:"text-xs text-[#a6ed2a] hover:text-white mt-2 inline-block",onClick:a=>a.stopPropagation(),children:"View full detail"})]}),f&&t.status==="complete"&&e.jsxs("div",{className:"border-t border-[#1d2839] p-4 bg-[#151515]",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase tracking-wider mb-2",children:"Extracted Artifacts"}),g[t.id]?g[t.id].length>0?e.jsx("div",{className:"space-y-2",children:g[t.id].map(a=>e.jsxs(d,{to:`/artifact/${a.id}`,className:"flex items-center gap-3 p-2 rounded-lg hover:bg-[#0a101d] transition-colors",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{backgroundColor:w[a.type]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-white truncate",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-xs text-gray-500",children:a.type.charAt(0).toUpperCase()+a.type.slice(1)}),a.rea_role&&e.jsx("span",{className:"text-xs",style:{color:_[a.rea_role]},children:C[a.rea_role]}),e.jsx("span",{className:"text-xs text-gray-600",children:k[a.state]})]})]}),a.summary&&e.jsx("p",{className:"hidden sm:block text-xs text-gray-500 max-w-[200px] truncate",children:a.summary})]},a.id))}):e.jsx("p",{className:"text-xs text-gray-500",children:"No artifacts extracted from this contribution."}):e.jsx("p",{className:"text-xs text-gray-500 animate-pulse",children:"Loading artifacts..."}),r.hlamt_tags&&r.hlamt_tags.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-[#1d2839]",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1.5",children:"Dimensions"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:r.hlamt_tags.map((a,B)=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-[#a6ed2a]/10 text-[#a6ed2a] font-mono",children:a},B))})]})]})]},t.id)})})]}),h.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-400"}),"All My Artifacts"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:h.map(t=>e.jsxs(d,{to:`/artifact/${t.id}`,className:"flex items-center gap-3 bg-[#0a101d] border border-[#1d2839] rounded-lg p-3 hover:border-[#a6ed2a] transition-colors",children:[e.jsx("span",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:w[t.type]}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:t.type.charAt(0).toUpperCase()+t.type.slice(1)}),t.rea_role&&e.jsx("span",{style:{color:_[t.rea_role]},children:C[t.rea_role]})]})]}),e.jsx("span",{className:"text-xs text-gray-600 flex-shrink-0",children:k[t.state]})]},t.id))})]})]})}export{ee as MyThread};
