import{c as q,u as G,r as o,s as u,j as e,X as W,L as Y}from"./index-Bg-tw-Nl.js";import{P as J}from"./plus-DEqEONde.js";import{H as B,C as X}from"./hash-D0ovnp95.js";import{U as K}from"./users-Dy_vPf0k.js";import{B as Q}from"./bot-Qmwzl7yk.js";const Z=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ee=q("lock",Z),T=["general","dimension","session","topic","meta"],H={general:"General",dimension:"Dimensions",session:"Sessions",topic:"Topics",meta:"Meta"},f=["human-to-human","human-to-agent","agent-to-agent"],i={"human-to-human":{label:"Human ↔ Human",description:"People connecting with people — discussion, debate, and shared understanding.",color:"#a6ed2a",bgColor:"rgba(166, 237, 42, 0.06)",borderColor:"rgba(166, 237, 42, 0.2)",iconBg:"rgba(166, 237, 42, 0.15)",icon:"users"},"human-to-agent":{label:"Human ↔ Agent",description:"Humans directing agents, asking questions, and receiving synthesized knowledge.",color:"#60a5fa",bgColor:"rgba(96, 165, 250, 0.06)",borderColor:"rgba(96, 165, 250, 0.2)",iconBg:"rgba(96, 165, 250, 0.15)",icon:"bot"},"agent-to-agent":{label:"Agent ↔ Agent",description:"Autonomous coordination between agents — extraction, synthesis, and graph maintenance.",color:"#a78bfa",bgColor:"rgba(167, 139, 250, 0.06)",borderColor:"rgba(167, 139, 250, 0.2)",iconBg:"rgba(167, 139, 250, 0.15)",icon:"cpu"}};function j({mode:m,className:a}){const h=i[m];return h.icon==="users"?e.jsx(K,{className:a}):h.icon==="bot"?e.jsx(Q,{className:a}):e.jsx(X,{className:a})}function te(m){const a=Math.floor((Date.now()-new Date(m).getTime())/1e3);return a<60?`${a}s ago`:a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`}function re(){const{convergence:m}=G(),[a,h]=o.useState([]),[P,$]=o.useState(!0),[p,y]=o.useState(null),[O,g]=o.useState(!1),[x,N]=o.useState(""),[w,C]=o.useState(""),[v,k]=o.useState("general"),[b,S]=o.useState("human-to-human"),[_,R]=o.useState("public"),[M,A]=o.useState(!1),[z,I]=o.useState(new Set),[c,D]=o.useState("all");o.useEffect(()=>{u.auth.getSession().then(({data:s})=>y(s.session));const{data:{subscription:t}}=u.auth.onAuthStateChange((s,r)=>y(r));return()=>t.unsubscribe()},[]),o.useEffect(()=>{E()},[]);async function E(){const{data:t}=await u.from("channels").select("*").order("position",{ascending:!0}).order("created_at",{ascending:!0}),s=t||[];h(s);const r=JSON.parse(localStorage.getItem("channel_last_read")||"{}"),n=new Set;for(const l of s){const d=r[l.slug];d&&new Date(l.updated_at)>new Date(d)?n.add(l.slug):d||n.add(l.slug)}I(n),$(!1)}async function V(){if(!x.trim()||!p)return;A(!0);const t=x.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),{data:s}=await u.from("participants").select("id").eq("auth_user_id",p.user.id).single(),{error:r}=await u.from("channels").insert({name:x.trim(),slug:t,description:w.trim()||null,type:v,communication_mode:b,visibility:_,convergence_id:m.id,created_by:s?.id||null});r||(N(""),C(""),k("general"),S("human-to-human"),g(!1),await E()),A(!1)}const F=c==="all"?a:a.filter(t=>t.communication_mode===c),L=f.map(t=>{const s=F.filter(n=>n.communication_mode===t),r=T.map(n=>({type:n,label:H[n],channels:s.filter(l=>l.type===n)})).filter(n=>n.channels.length>0);return{mode:t,config:i[t],typeGroups:r,count:s.length}}).filter(t=>t.count>0),U={all:a.length,"human-to-human":a.filter(t=>t.communication_mode==="human-to-human").length,"human-to-agent":a.filter(t=>t.communication_mode==="human-to-agent").length,"agent-to-agent":a.filter(t=>t.communication_mode==="agent-to-agent").length};return P?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Channels"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Three modes of communication in the commons."})]}),p&&e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 bg-[#a6ed2a] text-[#080c16] font-medium px-4 py-2 rounded-lg hover:bg-[#b8f247] transition-colors text-sm",children:[e.jsx(J,{className:"w-4 h-4"}),"New Channel"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6",children:f.map(t=>{const s=i[t],r=U[t],n=c===t;return e.jsxs("button",{onClick:()=>D(c===t?"all":t),className:"text-left rounded-xl p-4 border transition-all",style:{backgroundColor:n?s.bgColor:"transparent",borderColor:n?s.color:"#1d2839"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center",style:{backgroundColor:s.iconBg},children:e.jsx(j,{mode:t,className:"w-4 h-4",style:{color:s.color}})}),e.jsx("span",{className:"font-semibold text-sm",style:{color:s.color},children:s.label}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:r})]}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:s.description})]},t)})}),c!=="all"&&e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Showing:"}),e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full",style:{backgroundColor:i[c].bgColor,color:i[c].color,border:`1px solid ${i[c].borderColor}`},children:i[c].label}),e.jsx("button",{onClick:()=>D("all"),className:"text-xs text-gray-500 hover:text-white ml-1",children:"Clear filter"})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:()=>g(!1),children:e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6 w-full max-w-md",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"New Channel"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Name"}),e.jsx("input",{value:x,onChange:t=>N(t.target.value),placeholder:"channel-name",className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:w,onChange:t=>C(t.target.value),placeholder:"What's this channel about?",rows:2,className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Communication Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:f.map(t=>{const s=i[t];return e.jsxs("button",{type:"button",onClick:()=>S(t),className:"p-2 rounded-lg border text-center transition-all",style:{backgroundColor:b===t?s.bgColor:"transparent",borderColor:b===t?s.color:"#1d2839"},children:[e.jsx(j,{mode:t,className:"w-4 h-4 mx-auto mb-1",style:{color:s.color}}),e.jsx("span",{className:"text-xs",style:{color:b===t?s.color:"#9ca3af"},children:t==="human-to-human"?"H↔H":t==="human-to-agent"?"H↔A":"A↔A"})]},t)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Type"}),e.jsx("select",{value:v,onChange:t=>k(t.target.value),className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white text-sm",children:T.map(t=>e.jsx("option",{value:t,children:H[t]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Visibility"}),e.jsxs("select",{value:_,onChange:t=>R(t.target.value),className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white text-sm",children:[e.jsx("option",{value:"public",children:"Public — Anyone can view"}),e.jsx("option",{value:"members",children:"Members — Authenticated users only"})]})]}),e.jsx("button",{onClick:V,disabled:!x.trim()||M,className:"w-full bg-[#a6ed2a] text-[#080c16] font-medium py-2 rounded-lg hover:bg-[#b8f247] transition-colors text-sm disabled:opacity-50",children:M?"Creating...":"Create Channel"})]})]})}),L.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(B,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No channels yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create the first channel to start discussions."})]}):e.jsx("div",{className:"space-y-8",children:L.map(({mode:t,config:s,typeGroups:r})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:s.iconBg},children:e.jsx(j,{mode:t,className:"w-4 h-4",style:{color:s.color}})}),e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-bold",style:{color:s.color},children:s.label})}),e.jsx("div",{className:"flex-1 h-px",style:{backgroundColor:s.borderColor}})]}),e.jsx("div",{className:"space-y-4 ml-2",children:r.map(n=>e.jsxs("div",{children:[r.length>1&&e.jsx("h3",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider mb-1.5 ml-1",children:n.label}),e.jsx("div",{className:"space-y-1",children:n.channels.map(l=>e.jsxs(Y,{to:`/channels/${l.slug}`,className:"flex items-center gap-3 rounded-lg px-4 py-3 border transition-all group",style:{backgroundColor:s.bgColor,borderColor:"#1d2839"},onMouseEnter:d=>{d.currentTarget.style.borderColor=s.color},onMouseLeave:d=>{d.currentTarget.style.borderColor="#1d2839"},children:[e.jsx("div",{className:"flex-shrink-0 w-9 h-9 rounded-lg flex items-center justify-center transition-colors",style:{backgroundColor:s.iconBg},children:l.visibility==="members"?e.jsx(ee,{className:"w-4 h-4",style:{color:s.color}}):e.jsx(B,{className:"w-4 h-4",style:{color:s.color}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-white text-sm group-hover:opacity-90 transition-colors",children:l.name}),z.has(l.slug)&&e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:s.color}})]}),l.description?e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:l.description}):e.jsx("p",{className:"text-xs text-gray-700 mt-0.5",children:"No description"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-gray-600",children:te(l.updated_at)}),e.jsx("svg",{className:"w-4 h-4 text-gray-700 group-hover:opacity-80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m9 18 6-6-6-6"})})]})]},l.id))})]},n.type))})]},t))})]})}export{re as Channels};
