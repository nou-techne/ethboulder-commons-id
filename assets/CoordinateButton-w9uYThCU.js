import{r as n,j as i,s as a}from"./index-sqjsVm1m.js";import{H as h}from"./handshake-y5G9IvXE.js";function q({artifactId:r,compact:_=!1}){const[o,l]=n.useState(!1),[d,u]=n.useState(0),[p,f]=n.useState(!1),[s,w]=n.useState(null),[m,x]=n.useState(null);n.useEffect(()=>{async function t(){const{data:{session:e}}=await a.auth.getSession();w(e);const{count:S}=await a.from("coordination_interests").select("*",{count:"exact",head:!0}).eq("artifact_id",r);if(u(S||0),e?.user){const{data:g}=await a.from("participants").select("id").eq("auth_user_id",e.user.id).maybeSingle();if(g){x(g.id);const{data:j}=await a.from("coordination_interests").select("id").eq("artifact_id",r).eq("participant_id",g.id).maybeSingle();l(!!j)}}}t()},[r]);async function y(){if(m)return m;if(!s?.user)return null;const{data:t}=await a.from("participants").select("id").eq("auth_user_id",s.user.id).maybeSingle();if(t)return x(t.id),t.id;const{data:e}=await a.from("participants").insert({name:s.user.email?.split("@")[0]||"anon",auth_user_id:s.user.id}).select("id").single();return e?(x(e.id),e.id):null}async function b(){if(!(!s||p)){f(!0);try{const t=await y();if(!t){f(!1);return}o?(await a.from("coordination_interests").delete().eq("artifact_id",r).eq("participant_id",t),l(!1),u(e=>Math.max(0,e-1))):(await a.from("coordination_interests").insert({artifact_id:r,participant_id:t}),l(!0),u(e=>e+1))}catch(t){console.error("Coordinate toggle error:",t)}f(!1)}}const c=!s;return _?i.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),b()},disabled:c||p,className:`inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full transition-colors ${o?"bg-[#a6ed2a]/20 text-[#a6ed2a] border border-[#a6ed2a]/30":"bg-[#1d2839] text-gray-400 hover:text-[#a6ed2a] hover:bg-[#a6ed2a]/10"} ${c?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,title:s?o?"Remove coordination interest":"I want to coordinate on this":"Sign in to coordinate",children:[i.jsx(h,{className:"w-3 h-3"}),d>0&&i.jsx("span",{children:d})]}):i.jsxs("button",{onClick:b,disabled:c||p,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors text-sm ${o?"bg-[#a6ed2a]/20 text-[#a6ed2a] border border-[#a6ed2a]/30":"bg-[#1d2839] text-gray-300 hover:text-[#a6ed2a] hover:bg-[#a6ed2a]/10"} ${c?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[i.jsx(h,{className:"w-4 h-4"}),i.jsx("span",{children:o?"Coordinating":"Coordinate"}),d>0&&i.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-[#1d2839] text-xs",children:d})]})}export{q as C};
