import{c as N,r as d,s as l,j as e,l as v,k as _}from"./index-HXAgaps0.js";import{C as y}from"./clock-BStrjUFX.js";const w=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],h=N("circle",w),S={made:"bg-gray-700 text-gray-300",in_progress:"bg-blue-900/30 text-blue-400",fulfilled:"bg-green-900/30 text-green-400",broken:"bg-red-900/30 text-red-400"},C={made:h,in_progress:y,fulfilled:_,broken:v};function k(c){const s=Math.floor((Date.now()-new Date(c).getTime())/1e3);return s<60?`${s}s ago`:s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:`${Math.floor(s/86400)}d ago`}function M(){const[c,s]=d.useState([]),[i,g]=d.useState(null),[p,f]=d.useState(!0),[n,x]=d.useState(null),[D,b]=d.useState(null);d.useEffect(()=>{l.auth.getSession().then(({data:a})=>x(a.session));const{data:{subscription:t}}=l.auth.onAuthStateChange((a,r)=>x(r));return()=>t.unsubscribe()},[]),d.useEffect(()=>{n&&m()},[n]);async function m(){if(!n)return;const{data:t}=await l.from("participants").select("id").eq("auth_id",n.user.id).single();if(!t)return;b(t.id);const{data:a}=await l.from("commitments").select(`
        *,
        thread:threads(title)
      `).eq("participant_id",t.id).order("created_at",{ascending:!1}),r=(a||[]).map(u=>({...u,thread_title:u.thread?.title}));s(r);const{data:o}=await l.rpc("get_commitment_stats",{p_participant_id:t.id});o&&o.length>0&&g(o[0]),f(!1)}async function j(t,a){const{error:r}=await l.rpc("update_commitment_status",{p_commitment_id:t,p_status:a});r||await m()}return p?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):n?e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:"My Commitments"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Track commitments and fulfillment rate"})]}),i&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:i.total}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total"})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-300",children:i.made}),e.jsx("div",{className:"text-xs text-gray-500",children:"Made"})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:i.in_progress}),e.jsx("div",{className:"text-xs text-gray-500",children:"In Progress"})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:i.fulfilled}),e.jsx("div",{className:"text-xs text-gray-500",children:"Fulfilled"})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-[#a6ed2a]",children:[i.fulfillment_rate,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Fulfillment"})]})]}),c.length===0?e.jsxs("div",{className:"text-center py-16 bg-[#0a101d] border border-[#1d2839] rounded-lg",children:[e.jsx(h,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No commitments yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Commitments can be extracted from messages"})]}):e.jsx("div",{className:"space-y-3",children:c.map(t=>{const a=C[t.status];return e.jsx("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(a,{className:"w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white mb-2",children:t.commitment_text}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[t.thread_title&&e.jsxs("span",{children:["Thread: ",t.thread_title]}),e.jsx("span",{children:k(t.created_at)}),t.due_date&&e.jsxs("span",{className:new Date(t.due_date)<new Date?"text-red-400":"",children:["Due: ",new Date(t.due_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${S[t.status]}`,children:t.status.replace("_"," ")}),t.status!=="fulfilled"&&t.status!=="broken"&&e.jsxs("select",{value:t.status,onChange:r=>j(t.id,r.target.value),className:"bg-[#080c16] border border-[#1d2839] rounded px-2 py-1 text-xs text-white",children:[e.jsx("option",{value:"made",children:"Made"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"fulfilled",children:"Fulfilled"}),e.jsx("option",{value:"broken",children:"Broken"})]})]})]})},t.id)})})]}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Sign in to view your commitments"})]})}export{M as CommitmentDashboard};
