import{c as y,r as c,j as e,B as x}from"./index-CBgAWxJw.js";import{C as v,a as _,b}from"./Card-BxguQ2G0.js";import{I as j,T as I}from"./Input-mL-hyUfR.js";import{P as W}from"./plus-BnOs8FEl.js";const M=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],F=y("power",M);const D=[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]],N=y("webhook",D),w="commons_webhooks";class L{webhooks=new Map;constructor(){this.load()}load(){try{const s=localStorage.getItem(w);if(s){const a=JSON.parse(s);this.webhooks=new Map(a.map(r=>[r.id,r]))}}catch(s){console.error("Failed to load webhooks from storage:",s)}}save(){try{const s=Array.from(this.webhooks.values());localStorage.setItem(w,JSON.stringify(s))}catch(s){console.error("Failed to save webhooks to storage:",s)}}add(s){const a=this.generateId(),r=new Date().toISOString(),o={...s,id:a,created_at:r,updated_at:r};return this.webhooks.set(a,o),this.save(),o}get(s){return this.webhooks.get(s)}list(){return Array.from(this.webhooks.values())}listActive(){return this.list().filter(s=>s.active)}listByEvent(s){return this.listActive().filter(a=>a.events.includes(s))}update(s,a){const r=this.webhooks.get(s);if(!r)return null;const o={...r,...a,updated_at:new Date().toISOString()};return this.webhooks.set(s,o),this.save(),o}remove(s){const a=this.webhooks.delete(s);return a&&this.save(),a}clear(){this.webhooks.clear(),this.save()}generateId(){return`wh_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}}const i=new L,O=["contribution.created","contribution.processed","thread.created","thread.resolved","thread.consolidated","thread.archived","message.sent","message.edited","artifact.created","artifact.tagged","participant.joined","reaction.added"];function z(){const[m,s]=c.useState([]),[a,r]=c.useState(!1),[o,u]=c.useState(""),[l,g]=c.useState(new Set),[p,f]=c.useState("");c.useEffect(()=>{d()},[]);function d(){s(i.list())}function k(){!o||l.size===0||(i.add({url:o,events:Array.from(l),secret:p||A(),active:!0}),u(""),g(new Set),f(""),r(!1),d())}function S(t){const n=i.get(t);n&&(i.update(t,{active:!n.active}),d())}function C(t){confirm("Delete this webhook?")&&(i.remove(t),d())}function E(t){g(n=>{const h=new Set(n);return h.has(t)?h.delete(t):h.add(t),h})}function A(){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return Array.from({length:32},()=>t[Math.floor(Math.random()*t.length)]).join("")}return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(N,{className:"w-6 h-6 text-[#a6ed2a]"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Webhooks"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Receive real-time notifications when events occur"})]}),e.jsx(x,{onClick:()=>r(!a),icon:e.jsx(W,{className:"w-4 h-4"}),children:"Add Webhook"})]}),a&&e.jsxs(v,{className:"mb-6",children:[e.jsx(_,{children:e.jsx("h2",{className:"font-bold",children:"New Webhook"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsx(j,{label:"Endpoint URL",value:o,onChange:t=>u(t.target.value),placeholder:"https://example.com/webhook"}),e.jsx(j,{label:"Secret (optional, auto-generated if empty)",value:p,onChange:t=>f(t.target.value),placeholder:"Leave empty to auto-generate"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Events to Subscribe"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:O.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.has(t),onChange:()=>E(t),className:"rounded border-[#1d2839] bg-[#080c16] text-[#a6ed2a]"}),e.jsx("span",{className:"text-gray-300",children:t})]},t))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:k,disabled:!o||l.size===0,children:"Create Webhook"}),e.jsx(x,{variant:"ghost",onClick:()=>r(!1),children:"Cancel"})]})]})]}),m.length===0?e.jsxs("div",{className:"text-center py-16 text-gray-500",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No webhooks configured yet"})]}):e.jsx("div",{className:"space-y-4",children:m.map(t=>e.jsx(v,{children:e.jsx(b,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:t.url}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full font-medium ${t.active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:t.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:[t.events.length," event",t.events.length!==1?"s":""]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.events.slice(0,5).map(n=>e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-[#080c16] text-gray-400 border border-[#1d2839]",children:n},n)),t.events.length>5&&e.jsxs("span",{className:"text-xs px-2 py-0.5 text-gray-500",children:["+",t.events.length-5," more"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S(t.id),className:"text-gray-400 hover:text-white p-2",title:t.active?"Deactivate":"Activate",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(t.id),className:"text-gray-400 hover:text-red-400 p-2",title:"Delete",children:e.jsx(I,{className:"w-4 h-4"})})]})]})})},t.id))})]})}export{z as default};
