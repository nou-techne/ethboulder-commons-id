const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Graph-DIi99gcp.js","assets/index-CBgAWxJw.js","assets/index-D_rDOuyj.css","assets/EmptyState-DB6OcSfh.js","assets/network-Dq-n64D8.js"])))=>i.map(i=>d[i]);
import{c as z,u as ae,r as a,s as r,j as e,I as re,C as ne,L as p,S as G,A as oe,R as ie,a as H,b as le,d as B,_ as ce}from"./index-CBgAWxJw.js";import{E as de}from"./ExtractionProgress-4eY6OnOI.js";import{P as xe}from"./pen-line-CEWWvdTr.js";import{S as me}from"./sparkles-CjUSG4x2.js";import{G as he}from"./git-branch-azh6yor2.js";import{H as ue}from"./handshake-D_WhQiE_.js";import{C as pe}from"./chevron-right-ChBaX1-d.js";const fe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ge=z("chevron-left",fe);const be=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],je=z("inbox",be),ye=a.lazy(()=>ce(()=>import("./Graph-DIi99gcp.js"),__vite__mapDeps([0,1,2,3,4])).then(f=>({default:f.Graph}))),ve=["idea","proposal","commitment","pattern","synthesis","question","reflection"];function O(f){const o=Math.floor((Date.now()-new Date(f).getTime())/1e3);return o<60?`${o}s ago`:o<3600?`${Math.floor(o/60)}m ago`:o<86400?`${Math.floor(o/3600)}h ago`:`${Math.floor(o/86400)}d ago`}function Ae(){const{convergence:f}=ae(),o=f.dimensions,[E,m]=a.useState([]),[W,Y]=a.useState(!0),[_,A]=a.useState(""),[g,L]=a.useState(""),[l,T]=a.useState(""),[c,F]=a.useState(""),[k,I]=a.useState("coordination"),[b,V]=a.useState({}),[j,y]=a.useState(null),[v,P]=a.useState(()=>window.matchMedia("(max-width: 768px)").matches?"2d":"3d"),[N,K]=a.useState(!1),R=a.useRef(null);a.useEffect(()=>{function t(){K(!!document.fullscreenElement)}return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]);const[D,U]=a.useState([]),[Z,J]=a.useState({});a.useEffect(()=>{X();const t=r.channel("explore-artifacts").on("postgres_changes",{event:"INSERT",schema:"public",table:"artifacts"},i=>{m(n=>[i.new,...n].slice(0,50)),$()}).subscribe(),s=r.channel("explore-contributions").on("postgres_changes",{event:"*",schema:"public",table:"contributions"},()=>{q()}).subscribe();return()=>{r.removeChannel(t),r.removeChannel(s)}},[]),a.useEffect(()=>{ee()},[g,l,c,k]);async function $(){const[{data:t},{count:s},{data:i}]=await Promise.all([r.from("tags").select("name, artifact_tags(count)").like("name","hlamt:%"),r.from("participants").select("*",{count:"exact",head:!0}),r.rpc("word_frequencies")]),n={};if(t)for(const w of t){const S=w.artifact_tags;n[w.name]=S?.[0]?.count??0}n["hlamt:H"]=s??0,i&&(n["hlamt:L"]=i.length),J(n)}async function q(){const{data:t}=await r.from("contribution_feed").select("*").limit(30);U(t||[])}async function Q(){const{data:t}=await r.from("coordination_interests").select("artifact_id"),s={};if(t)for(const i of t)s[i.artifact_id]=(s[i.artifact_id]||0)+1;return V(s),s}async function X(){const[{data:t}]=await Promise.all([r.from("artifacts").select("*").order("created_at",{ascending:!1}).limit(50)]);m(t||[]),await Promise.all([q(),$(),Q()]),Y(!1)}async function ee(){if(g){const{data:t}=await r.from("tags").select("id").eq("name",g).single();if(t){const{data:s}=await r.from("artifact_tags").select("artifact_id").eq("tag_id",t.id);if(s&&s.length>0){const i=s.map(S=>S.artifact_id);let n=r.from("artifacts").select("*").in("id",i).order("created_at",{ascending:!1}).limit(50);l&&(n=n.eq("type",l)),c&&(n=n.eq("state",c));const{data:w}=await n;m(w||[])}else m([])}else m([])}else{let t=r.from("artifacts").select("*").order("created_at",{ascending:!1}).limit(50);l&&(t=t.eq("type",l)),c&&(t=t.eq("state",c));const{data:s}=await t;m(s||[])}y(null)}async function M(){if(!_.trim()){y(null);return}const{data:t}=await r.rpc("search_artifacts",{p_query:_});y(t||[])}const[C,te]=a.useState(!1),[h,u]=a.useState(0),d=10,se=k==="coordination"?[...E].sort((t,s)=>(b[s.id]||0)-(b[t.id]||0)):E,x=j??se;return W?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Explore"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"The knowledge graph and live activity, side by side."})]}),e.jsxs("div",{className:"mb-6 bg-[#0a101d] border border-[#1d2839] rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>te(!C),className:"w-full px-4 py-3 flex items-center justify-between text-left hover:bg-[#1d2839] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-[#a6ed2a]"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"How it works"})]}),e.jsx(ne,{className:`w-5 h-5 text-gray-400 transition-transform ${C?"rotate-180":""}`})]}),C&&e.jsxs("div",{className:"px-4 pb-4 text-sm space-y-3 border-t border-[#1d2839] pt-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-[#a6ed2a] text-[#080c16] flex items-center justify-center",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium mb-1",children:"Contribute observations"}),e.jsx("div",{className:"text-gray-400",children:"Share what you noticed at ETHBoulder — session notes, ideas, commitments, questions. Write naturally."})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-[#a6ed2a] text-[#080c16] flex items-center justify-center",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium mb-1",children:"AI extracts knowledge"}),e.jsx("div",{className:"text-gray-400",children:"Each contribution is analyzed, broken into artifacts (resources, events, agents), and tagged by dimension."})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-[#a6ed2a] text-[#080c16] flex items-center justify-center",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium mb-1",children:"The graph grows"}),e.jsx("div",{className:"text-gray-400",children:"Artifacts connect to each other. Patterns emerge. The collective knowledge becomes navigable by dimension, type, and relationship."})]})]}),e.jsx("div",{className:"pt-2 border-t border-[#1d2839]",children:e.jsx(p,{to:"/contribute",className:"text-[#a6ed2a] hover:text-white text-sm font-medium",children:"Try it yourself →"})})]})]}),e.jsx("h2",{className:"text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wider",children:"Graph Dimensions"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-6 gap-2 mb-6",children:o.map(t=>{const s=Z[t.tag]??0;return e.jsxs(p,{to:`/d/${t.key}`,className:"block rounded-lg border border-[#1d2839] bg-[#0a101d] p-3 sm:p-4 hover:border-[#a6ed2a] transition-colors text-center group",children:[e.jsx("div",{className:"text-xs font-medium mb-1 truncate",style:{color:t.color},children:t.name}),e.jsxs("div",{className:"flex items-baseline justify-center gap-1 sm:gap-1.5",children:[e.jsx("span",{className:"font-mono text-xl sm:text-2xl font-bold",style:{color:t.color},children:t.letter}),e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white",children:s})]}),e.jsx("span",{className:"text-xs text-gray-400 group-hover:text-white transition-colors block truncate",children:t.desc})]},t.key)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-300 uppercase tracking-wider",children:v==="3d"?"Graph Constellation":"Graph Index"}),e.jsxs("div",{className:"flex bg-[#0a101d] border border-[#1d2839] rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>P("2d"),className:`px-4 py-2 text-sm font-semibold transition-colors ${v==="2d"?"bg-[#a6ed2a] text-[#080c16]":"text-gray-400 hover:text-white"}`,children:"2-D"}),e.jsx("button",{onClick:()=>P("3d"),className:`px-4 py-2 text-sm font-semibold transition-colors ${v==="3d"?"bg-[#a6ed2a] text-[#080c16]":"text-gray-400 hover:text-white"}`,children:"3-D"})]})]}),v==="3d"?e.jsx("div",{ref:R,className:`relative ${N?"bg-[#080c16] w-screen h-screen":""}`,children:e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"text-gray-500",children:"Loading constellation..."})}),children:e.jsxs("div",{className:`relative w-full ${N?"h-full":"h-[700px]"}`,children:[e.jsx(ye,{}),e.jsx("button",{onClick:()=>{N?document.exitFullscreen():R.current?.requestFullscreen()},className:"absolute bottom-3 left-3 z-50 px-4 py-2 text-sm bg-[#0a101d]/90 text-gray-300 rounded-lg hover:border-[#a6ed2a] transition-colors backdrop-blur-sm border border-[#1d2839]",children:N?"Exit Fullscreen":"Fullscreen"})]})})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{value:_,onChange:t=>A(t.target.value),onKeyDown:t=>t.key==="Enter"&&M(),placeholder:"Search the graph...",className:"flex-1 bg-[#0a101d] border border-[#1d2839] rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm"}),e.jsx("button",{onClick:M,className:"bg-[#a6ed2a] text-[#080c16] hover:bg-[#b8f247] px-3 sm:px-4 py-2 rounded-lg transition-colors text-sm whitespace-nowrap",children:"Search"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("select",{value:g,onChange:t=>{L(t.target.value),u(0)},className:"bg-[#0a101d] border border-[#1d2839] rounded-lg px-3 py-1.5 text-xs text-white flex-shrink-0",children:[e.jsx("option",{value:"",children:"All dimensions"}),o.map(t=>e.jsxs("option",{value:t.tag,children:[t.letter," ",t.name]},t.key))]}),e.jsxs("select",{value:l,onChange:t=>{T(t.target.value),u(0)},className:"bg-[#0a101d] border border-[#1d2839] rounded-lg px-3 py-1.5 text-xs text-white flex-shrink-0",children:[e.jsx("option",{value:"",children:"All types"}),ve.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]}),e.jsxs("select",{value:c,onChange:t=>{F(t.target.value),u(0)},className:"bg-[#0a101d] border border-[#1d2839] rounded-lg px-3 py-1.5 text-xs text-white flex-shrink-0",children:[e.jsx("option",{value:"",children:"All states"}),Object.entries(G).map(([t,s])=>e.jsx("option",{value:t,children:s},t))]}),e.jsxs("select",{value:k,onChange:t=>I(t.target.value),className:"bg-[#0a101d] border border-[#1d2839] rounded-lg px-3 py-1.5 text-xs text-white flex-shrink-0",children:[e.jsx("option",{value:"recent",children:"Sort: Recent"}),e.jsx("option",{value:"coordination",children:"Sort: Coordination"})]}),(g||l||c||j)&&e.jsx("button",{onClick:()=>{L(""),T(""),F(""),A(""),y(null),I("recent"),u(0)},className:"text-xs text-gray-400 hover:text-white flex-shrink-0",children:"Clear"})]})]}),x.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-[#1d2839] flex items-center justify-center mx-auto mb-6",children:e.jsx(je,{className:"w-10 h-10 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:j?"No matching artifacts":"The knowledge graph is empty"}),e.jsx("p",{className:"text-gray-400 mb-6 leading-relaxed",children:j?"Try a different search term or clear your filters.":"Be the first to contribute. Share an observation, idea, or commitment from ETHBoulder and watch it become part of the living archive."}),e.jsx(p,{to:"/contribute",className:"inline-block bg-[#a6ed2a] text-[#080c16] font-medium px-6 py-3 rounded-lg hover:bg-[#b8f247] transition-colors",children:"Contribute to the Commons"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x.slice(h*d,(h+1)*d).map(t=>e.jsxs(p,{to:`/artifact/${t.id}`,className:"block bg-[#0a101d] border border-[#1d2839] rounded-xl p-4 hover:border-[#a6ed2a] transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded-full",style:{backgroundColor:oe[t.type]}}),e.jsx("span",{className:"text-xs uppercase tracking-wider text-gray-400",children:t.type}),t.rea_role&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded border",style:{color:H[t.rea_role],borderColor:H[t.rea_role]+"40"},children:ie[t.rea_role]}),t.agent_type&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded border",style:{color:B[t.agent_type],borderColor:B[t.agent_type]+"40"},children:le[t.agent_type]}),e.jsx("span",{className:"ml-auto text-xs text-gray-500",children:G[t.state]})]}),e.jsx("h3",{className:"font-semibold text-white group-hover:text-[#a6ed2a] transition-colors mb-1 text-sm",children:t.title}),t.summary&&e.jsx("p",{className:"text-xs text-gray-400 line-clamp-2",children:t.summary}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-600",children:[e.jsx("span",{children:O(t.created_at)}),(b[t.id]||0)>0&&e.jsxs("span",{className:"flex items-center gap-1 text-[#a6ed2a]",children:[e.jsx(ue,{className:"w-3 h-3"}),b[t.id]]})]})]},t.id))}),x.length>d&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("button",{onClick:()=>u(t=>Math.max(0,t-1)),disabled:h===0,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-[#0a101d] border border-[#1d2839] text-gray-300 hover:border-[#a6ed2a] transition-colors disabled:opacity-30 disabled:cursor-not-allowed",children:[e.jsx(ge,{className:"w-4 h-4"})," Prev"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[h*d+1,"–",Math.min((h+1)*d,x.length)," of ",x.length]}),e.jsxs("button",{onClick:()=>u(t=>Math.min(Math.ceil(x.length/d)-1,t+1)),disabled:(h+1)*d>=x.length,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-lg bg-[#0a101d] border border-[#1d2839] text-gray-300 hover:border-[#a6ed2a] transition-colors disabled:opacity-30 disabled:cursor-not-allowed",children:["Next ",e.jsx(pe,{className:"w-4 h-4"})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-300 mb-3 uppercase tracking-wider",children:"Live Activity"}),D.length===0?e.jsx("div",{className:"text-gray-500 text-center py-8 text-sm",children:"No contributions yet"}):e.jsx("div",{className:"space-y-1.5",children:D.map(t=>e.jsxs(p,{to:`/contribution/${t.id}`,className:"block bg-[#0a101d] border border-[#1d2839] rounded-lg p-3 hover:border-[#a6ed2a] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${t.status==="complete"?"bg-[#a6ed2a]":t.status==="processing"?"bg-blue-400 animate-pulse":t.status==="error"?"bg-red-400":"bg-yellow-400"}`}),t.participant_name&&t.participant_id&&e.jsx(p,{to:`/p/${t.participant_id}`,className:"text-xs font-medium text-gray-300 truncate hover:text-[#a6ed2a] transition-colors",onClick:s=>s.stopPropagation(),children:t.participant_name}),t.participant_name&&!t.participant_id&&e.jsx("span",{className:"text-xs font-medium text-gray-300 truncate",children:t.participant_name}),e.jsx("span",{className:"text-xs text-gray-600 ml-auto flex-shrink-0",children:O(t.created_at)})]}),t.title&&e.jsx("p",{className:"text-sm font-medium text-white mb-1",children:t.title}),e.jsx("p",{className:"text-xs text-gray-400 line-clamp-2 mb-1.5",children:t.preview}),t.status==="complete"&&(t.artifact_count>0||t.relationship_count>0)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 mt-1",children:[t.artifact_count>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[e.jsx("span",{className:"font-mono text-[#a6ed2a] font-medium",children:t.artifact_count})," ",t.artifact_count===1?"node":"nodes"]}),t.relationship_count>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[e.jsx("span",{className:"font-mono text-[#a6ed2a] font-medium",children:t.relationship_count})," ",t.relationship_count===1?"edge":"edges"]}),t.commitment_count>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:[e.jsx("span",{className:"font-mono text-amber-400 font-medium",children:t.commitment_count})," ",t.commitment_count===1?"commitment":"commitments"]})]}),t.status==="processing"&&e.jsx("div",{className:"mt-1",children:e.jsx(de,{startedAt:t.created_at,compact:!0})}),t.status==="error"&&e.jsx("span",{className:"text-xs text-red-400",children:"Extraction failed"})]},t.id))})]})]})]})}export{Ae as Explore};
