import{c as n,r as l,s as c,j as e,C as L}from"./index-fauWS-PQ.js";import{A}from"./activity-Y78O_LWe.js";const C=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],f=n("circle-alert",C);const M=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],D=n("circle-check-big",M);const E=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],R=n("refresh-cw",E);const I=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],$=n("triangle-alert",I);function T(){const[t,p]=l.useState(null),[o,v]=l.useState([]),[x,m]=l.useState([]),[h,g]=l.useState(new Set),[N,u]=l.useState(null),[b,y]=l.useState(!0),[_,w]=l.useState(new Date);async function j(){const{data:s}=await c.from("extraction_health_metrics").select("*").single(),{data:d}=await c.rpc("get_recent_extraction_errors",{limit_count:5}),{data:a}=await c.from("contributions").select("id, content, errors, created_at").eq("status","error").order("created_at",{ascending:!1}).limit(20);p(s),v(d||[]),m((a||[]).map(r=>({id:r.id,content:r.content,errors:r.errors,created_at:r.created_at??""}))),w(new Date),y(!1)}async function S(s){g(a=>new Set(a).add(s));const{error:d}=await c.from("contributions").update({status:"pending",errors:null}).eq("id",s);d||m(a=>a.filter(r=>r.id!==s)),g(a=>{const r=new Set(a);return r.delete(s),r})}if(l.useEffect(()=>{c.auth.getSession().then(({data:d})=>u(d.session));const{data:{subscription:s}}=c.auth.onAuthStateChange((d,a)=>u(a));return()=>s.unsubscribe()},[]),l.useEffect(()=>{j();const s=setInterval(j,1e4);return()=>clearInterval(s)},[]),b||!t)return e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-16",children:[e.jsx(A,{className:"w-12 h-12 text-gray-500 mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-gray-400",children:"Loading system health..."})]});const i=t.failure_rate_pct<20,k=t.contributions_last_hour>0;return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"System Status"}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Last update: ",_.toLocaleTimeString()]})]}),e.jsxs("div",{className:`rounded-lg p-6 mb-6 border-2 ${i?"bg-green-900/10 border-green-800/30":"bg-red-900/10 border-red-800/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i?e.jsx(D,{className:"w-6 h-6 text-green-500"}):e.jsx(f,{className:"w-6 h-6 text-red-500"}),e.jsx("h2",{className:"text-xl font-bold",children:i?"System Healthy":"System Degraded"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:i?"Extraction pipeline operating normally":`Warning: ${t.failure_rate_pct}% failure rate in last hour`})]}),e.jsxs("div",{className:"bg-[#1a1a1a] border border-[#262626] rounded-lg p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-[#c3fd50]"}),"Last Hour"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.contributions_last_hour}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total contributions"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:t.successful}),e.jsx("div",{className:"text-xs text-gray-500",children:"Successful"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:t.failed}),e.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:t.processing+t.pending}),e.jsx("div",{className:"text-xs text-gray-500",children:"In progress"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-[#262626] grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold",children:[t.success_rate_pct,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Success rate"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold",children:[t.avg_processing_seconds,"s"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Avg processing time"})]})]})]}),e.jsxs("div",{className:"bg-[#1a1a1a] border border-[#262626] rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Last 24 Hours"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.contributions_last_24h}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total contributions"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:t.successful_24h}),e.jsx("div",{className:"text-xs text-gray-500",children:"Successful"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:t.failed_24h}),e.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t.success_rate_24h_pct,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Success rate"})]})]})]}),o.length>0&&e.jsxs("div",{className:"bg-[#1a1a1a] border border-red-800/30 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-red-500"}),"Recent Errors (",o.length,")"]}),e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsxs("div",{className:"bg-[#0f0f0f] border border-[#262626] rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:new Date(s.created_at).toLocaleString()}),e.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:[s.content_preview,"..."]}),s.errors&&s.errors.length>0&&e.jsx("div",{className:"text-xs font-mono text-red-400",children:s.errors[s.errors.length-1].message})]},s.contribution_id))})]}),!k&&e.jsx("div",{className:"bg-[#1a1a1a] border border-[#262626] rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-gray-400",children:"No contributions in the last hour"})}),x.length>0&&e.jsxs("div",{className:"bg-[#1a1a1a] border border-red-800/30 rounded-lg p-6 mt-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-red-400"}),"Error Recovery (",x.length,")"]}),e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsx("div",{className:"bg-[#0f0f0f] border border-[#262626] rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:new Date(s.created_at).toLocaleString()}),e.jsxs("div",{className:"text-sm text-gray-300 mb-2 truncate",children:[s.content?.slice(0,120),s.content?.length>120?"...":""]}),s.errors&&e.jsx("div",{className:"text-xs font-mono text-red-400",children:Array.isArray(s.errors)?s.errors[s.errors.length-1]?.message??JSON.stringify(s.errors[s.errors.length-1]):typeof s.errors=="object"?s.errors.message??JSON.stringify(s.errors):String(s.errors)})]}),N&&e.jsxs("button",{onClick:()=>S(s.id),disabled:h.has(s.id),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium bg-[#c3fd50]/10 text-[#c3fd50] border border-[#c3fd50]/30 hover:bg-[#c3fd50]/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shrink-0",children:[e.jsx(R,{className:`w-3.5 h-3.5 ${h.has(s.id)?"animate-spin":""}`}),"Retry"]})]})},s.id))})]})]})}export{T as Status};
