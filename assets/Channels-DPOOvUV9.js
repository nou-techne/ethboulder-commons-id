import{c as G,u as W,r as l,s as b,j as e,X as Y,L as q}from"./index-CJNRV6Bu.js";import{P as J}from"./plus-B8hgIcUf.js";import{H as A,C as X}from"./hash-D97DZbLk.js";import{U as K}from"./users-CUqYRt7S.js";import{B as Q}from"./bot-vEdEmAzK.js";const Z=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ee=G("lock",Z),T=["general","dimension","session","topic","meta"],P={general:"General",dimension:"Dimensions",session:"Sessions",topic:"Topics",meta:"Meta"},f=["human-to-human","human-to-agent","agent-to-agent"],i={"human-to-human":{label:"Human ↔ Human",description:"People connecting with people — discussion, debate, and shared understanding.",color:"#a6ed2a",bgColor:"rgba(166, 237, 42, 0.06)",borderColor:"rgba(166, 237, 42, 0.2)",iconBg:"rgba(166, 237, 42, 0.15)",icon:"users"},"human-to-agent":{label:"Human ↔ Agent",description:"Humans directing agents, asking questions, and receiving synthesized knowledge.",color:"#60a5fa",bgColor:"rgba(96, 165, 250, 0.06)",borderColor:"rgba(96, 165, 250, 0.2)",iconBg:"rgba(96, 165, 250, 0.15)",icon:"bot"},"agent-to-agent":{label:"Agent ↔ Agent",description:"Autonomous coordination between agents — extraction, synthesis, and graph maintenance.",color:"#a78bfa",bgColor:"rgba(167, 139, 250, 0.06)",borderColor:"rgba(167, 139, 250, 0.2)",iconBg:"rgba(167, 139, 250, 0.15)",icon:"cpu"}};function j({mode:m,className:n}){const u=i[m];return u.icon==="users"?e.jsx(K,{className:n}):u.icon==="bot"?e.jsx(Q,{className:n}):e.jsx(X,{className:n})}function se(m){const n=Math.floor((Date.now()-new Date(m).getTime())/1e3);return n<60?`${n}s ago`:n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:`${Math.floor(n/86400)}d ago`}function re(){const{convergence:m}=W(),[n,u]=l.useState([]),[$,H]=l.useState(!0),[p,y]=l.useState(null),[O,h]=l.useState(!1),[x,N]=l.useState(""),[C,w]=l.useState(""),[v,k]=l.useState("general"),[g,S]=l.useState("human-to-human"),[_,R]=l.useState("public"),[M,D]=l.useState(!1),[z,I]=l.useState(new Set),[c,E]=l.useState("all");l.useEffect(()=>{b.auth.getSession().then(({data:t})=>y(t.session));const{data:{subscription:s}}=b.auth.onAuthStateChange((t,r)=>y(r));return()=>s.unsubscribe()},[]),l.useEffect(()=>{L()},[]);async function L(){const{data:s}=await b.from("channels").select("*").order("position",{ascending:!0}).order("created_at",{ascending:!0}),t=s||[];u(t);const r=JSON.parse(localStorage.getItem("channel_last_read")||"{}"),a=new Set;for(const o of t){const d=r[o.slug];d&&new Date(o.updated_at)>new Date(d)?a.add(o.slug):d||a.add(o.slug)}I(a),H(!1)}async function U(){if(!x.trim()||!p)return;D(!0);const s=x.trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),{error:t}=await b.from("channels").insert({name:x.trim(),slug:s,description:C.trim()||null,type:v,communication_mode:g,visibility:_,convergence_id:m.id,created_by:p.user.id});t||(N(""),w(""),k("general"),S("human-to-human"),h(!1),await L()),D(!1)}const V=c==="all"?n:n.filter(s=>s.communication_mode===c),B=f.map(s=>{const t=V.filter(a=>a.communication_mode===s),r=T.map(a=>({type:a,label:P[a],channels:t.filter(o=>o.type===a)})).filter(a=>a.channels.length>0);return{mode:s,config:i[s],typeGroups:r,count:t.length}}).filter(s=>s.count>0),F={all:n.length,"human-to-human":n.filter(s=>s.communication_mode==="human-to-human").length,"human-to-agent":n.filter(s=>s.communication_mode==="human-to-agent").length,"agent-to-agent":n.filter(s=>s.communication_mode==="agent-to-agent").length};return $?e.jsx("div",{className:"text-center text-gray-500 py-12",children:"Loading..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Channels"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Three modes of communication in the commons."})]}),p&&e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 bg-[#a6ed2a] text-[#080c16] font-medium px-4 py-2 rounded-lg hover:bg-[#b8f247] transition-colors text-sm",children:[e.jsx(J,{className:"w-4 h-4"}),"New Channel"]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6",children:f.map(s=>{const t=i[s],r=F[s],a=c===s;return e.jsxs("button",{onClick:()=>E(c===s?"all":s),className:"text-left rounded-xl p-4 border transition-all",style:{backgroundColor:a?t.bgColor:"transparent",borderColor:a?t.color:"#1d2839"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg flex items-center justify-center",style:{backgroundColor:t.iconBg},children:e.jsx(j,{mode:s,className:"w-4 h-4",style:{color:t.color}})}),e.jsx("span",{className:"font-semibold text-sm",style:{color:t.color},children:t.label}),e.jsx("span",{className:"text-xs text-gray-500 ml-auto",children:r})]}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:t.description})]},s)})}),c!=="all"&&e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Showing:"}),e.jsx("span",{className:"text-xs font-medium px-2 py-1 rounded-full",style:{backgroundColor:i[c].bgColor,color:i[c].color,border:`1px solid ${i[c].borderColor}`},children:i[c].label}),e.jsx("button",{onClick:()=>E("all"),className:"text-xs text-gray-500 hover:text-white ml-1",children:"Clear filter"})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",onClick:()=>h(!1),children:e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-xl p-6 w-full max-w-md",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold",children:"New Channel"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-white",children:e.jsx(Y,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Name"}),e.jsx("input",{value:x,onChange:s=>N(s.target.value),placeholder:"channel-name",className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:C,onChange:s=>w(s.target.value),placeholder:"What's this channel about?",rows:2,className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:border-[#a6ed2a] text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Communication Mode"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:f.map(s=>{const t=i[s];return e.jsxs("button",{type:"button",onClick:()=>S(s),className:"p-2 rounded-lg border text-center transition-all",style:{backgroundColor:g===s?t.bgColor:"transparent",borderColor:g===s?t.color:"#1d2839"},children:[e.jsx(j,{mode:s,className:"w-4 h-4 mx-auto mb-1",style:{color:t.color}}),e.jsx("span",{className:"text-xs",style:{color:g===s?t.color:"#9ca3af"},children:s.split("-").map(r=>r[0].toUpperCase()).join("↔")})]},s)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Type"}),e.jsx("select",{value:v,onChange:s=>k(s.target.value),className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white text-sm",children:T.map(s=>e.jsx("option",{value:s,children:P[s]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Visibility"}),e.jsxs("select",{value:_,onChange:s=>R(s.target.value),className:"w-full bg-[#080c16] border border-[#1d2839] rounded-lg px-3 py-2 text-white text-sm",children:[e.jsx("option",{value:"public",children:"Public — Anyone can view"}),e.jsx("option",{value:"members",children:"Members — Authenticated users only"})]})]}),e.jsx("button",{onClick:U,disabled:!x.trim()||M,className:"w-full bg-[#a6ed2a] text-[#080c16] font-medium py-2 rounded-lg hover:bg-[#b8f247] transition-colors text-sm disabled:opacity-50",children:M?"Creating...":"Create Channel"})]})]})}),B.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(A,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No channels yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Create the first channel to start discussions."})]}):e.jsx("div",{className:"space-y-8",children:B.map(({mode:s,config:t,typeGroups:r})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:t.iconBg},children:e.jsx(j,{mode:s,className:"w-4 h-4",style:{color:t.color}})}),e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-bold",style:{color:t.color},children:t.label})}),e.jsx("div",{className:"flex-1 h-px",style:{backgroundColor:t.borderColor}})]}),e.jsx("div",{className:"space-y-4 ml-2",children:r.map(a=>e.jsxs("div",{children:[r.length>1&&e.jsx("h3",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider mb-1.5 ml-1",children:a.label}),e.jsx("div",{className:"space-y-1",children:a.channels.map(o=>e.jsxs(q,{to:`/channels/${o.slug}`,className:"flex items-center gap-3 rounded-lg px-4 py-3 border transition-all group",style:{backgroundColor:t.bgColor,borderColor:"#1d2839"},onMouseEnter:d=>{d.currentTarget.style.borderColor=t.color},onMouseLeave:d=>{d.currentTarget.style.borderColor="#1d2839"},children:[e.jsx("div",{className:"flex-shrink-0 w-9 h-9 rounded-lg flex items-center justify-center transition-colors",style:{backgroundColor:t.iconBg},children:o.visibility==="members"?e.jsx(ee,{className:"w-4 h-4",style:{color:t.color}}):e.jsx(A,{className:"w-4 h-4",style:{color:t.color}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-white text-sm group-hover:opacity-90 transition-colors",children:o.name}),z.has(o.slug)&&e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:t.color}})]}),o.description?e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:o.description}):e.jsx("p",{className:"text-xs text-gray-700 mt-0.5",children:"No description"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-gray-600",children:se(o.updated_at)}),e.jsx("svg",{className:"w-4 h-4 text-gray-700 group-hover:opacity-80",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"m9 18 6-6-6-6"})})]})]},o.id))})]},a.type))})]},s))})]})}export{re as Channels};
