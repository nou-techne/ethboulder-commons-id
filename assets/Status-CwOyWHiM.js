import{r as d,s as i,j as e,k as C,T as A,p as L}from"./index-HXAgaps0.js";import{A as D}from"./activity-BCj9h6-F.js";import{C as j}from"./circle-alert-CG8wr6EG.js";import{C as E}from"./clock-BStrjUFX.js";function H(){const[t,b]=d.useState(null),[c,v]=d.useState([]),[o,x]=d.useState([]),[m,h]=d.useState(new Set),[N,g]=d.useState(null),[f,p]=d.useState(!0),[y,_]=d.useState(new Date);async function u(){const{data:s}=await i.from("extraction_health_metrics").select("*").single(),{data:l}=await i.rpc("get_recent_extraction_errors",{limit_count:5}),{data:r}=await i.from("contributions").select("id, content, errors, created_at").eq("status","error").order("created_at",{ascending:!1}).limit(20);b(s),v(l||[]),x((r||[]).map(a=>({id:a.id,content:a.content,errors:a.errors,created_at:a.created_at??""}))),_(new Date),p(!1)}async function S(s){h(r=>new Set(r).add(s));const{error:l}=await i.from("contributions").update({status:"pending",errors:null}).eq("id",s);l||x(r=>r.filter(a=>a.id!==s)),h(r=>{const a=new Set(r);return a.delete(s),a})}if(d.useEffect(()=>{i.auth.getSession().then(({data:l})=>g(l.session));const{data:{subscription:s}}=i.auth.onAuthStateChange((l,r)=>g(r));return()=>s.unsubscribe()},[]),d.useEffect(()=>{u();const s=setInterval(u,1e4);return()=>clearInterval(s)},[]),f||!t)return e.jsxs("div",{className:"max-w-4xl mx-auto text-center py-16",children:[e.jsx(D,{className:"w-12 h-12 text-gray-500 mx-auto mb-4 animate-pulse"}),e.jsx("p",{className:"text-gray-400",children:"Loading system health..."})]});const n=t.failure_rate_pct<20,w=t.contributions_last_hour>0;return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"System Status"}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Last update: ",y.toLocaleTimeString()]})]}),e.jsxs("div",{className:`rounded-lg p-6 mb-6 border-2 ${n?"bg-green-900/10 border-green-800/30":"bg-red-900/10 border-red-800/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n?e.jsx(C,{className:"w-6 h-6 text-green-500"}):e.jsx(j,{className:"w-6 h-6 text-red-500"}),e.jsx("h2",{className:"text-xl font-bold",children:n?"System Healthy":"System Degraded"})]}),e.jsx("p",{className:"text-sm text-gray-400",children:n?"Extraction pipeline operating normally":`Warning: ${t.failure_rate_pct}% failure rate in last hour`})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-[#a6ed2a]"}),"Last Hour"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.contributions_last_hour}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total contributions"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:t.successful}),e.jsx("div",{className:"text-xs text-gray-500",children:"Successful"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:t.failed}),e.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:t.processing+t.pending}),e.jsx("div",{className:"text-xs text-gray-500",children:"In progress"})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-[#1d2839] grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold",children:[t.success_rate_pct,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Success rate"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold",children:[t.avg_processing_seconds,"s"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Avg processing time"})]})]})]}),e.jsxs("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Last 24 Hours"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.contributions_last_24h}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total contributions"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:t.successful_24h}),e.jsx("div",{className:"text-xs text-gray-500",children:"Successful"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:t.failed_24h}),e.jsx("div",{className:"text-xs text-gray-500",children:"Failed"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t.success_rate_24h_pct,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Success rate"})]})]})]}),c.length>0&&e.jsxs("div",{className:"bg-[#0a101d] border border-red-800/30 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-red-500"}),"Recent Errors (",c.length,")"]}),e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"bg-[#080c16] border border-[#1d2839] rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:new Date(s.created_at).toLocaleString()}),e.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:[s.content_preview,"..."]}),s.errors&&s.errors.length>0&&e.jsx("div",{className:"text-xs font-mono text-red-400",children:s.errors[s.errors.length-1].message})]},s.contribution_id))})]}),!w&&e.jsx("div",{className:"bg-[#0a101d] border border-[#1d2839] rounded-lg p-6 text-center",children:e.jsx("p",{className:"text-gray-400",children:"No contributions in the last hour"})}),o.length>0&&e.jsxs("div",{className:"bg-[#0a101d] border border-red-800/30 rounded-lg p-6 mt-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-red-400"}),"Error Recovery (",o.length,")"]}),e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsx("div",{className:"bg-[#080c16] border border-[#1d2839] rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:new Date(s.created_at).toLocaleString()}),e.jsxs("div",{className:"text-sm text-gray-300 mb-2 truncate",children:[s.content?.slice(0,120),s.content?.length>120?"...":""]}),s.errors&&e.jsx("div",{className:"text-xs font-mono text-red-400",children:Array.isArray(s.errors)?s.errors[s.errors.length-1]?.message??JSON.stringify(s.errors[s.errors.length-1]):typeof s.errors=="object"?s.errors.message??JSON.stringify(s.errors):String(s.errors)})]}),N&&e.jsxs("button",{onClick:()=>S(s.id),disabled:m.has(s.id),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-sm font-medium bg-[#a6ed2a]/10 text-[#a6ed2a] border border-[#a6ed2a]/30 hover:bg-[#a6ed2a]/20 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shrink-0",children:[e.jsx(L,{className:`w-3.5 h-3.5 ${m.has(s.id)?"animate-spin":""}`}),"Retry"]})]})},s.id))})]})]})}export{H as Status};
